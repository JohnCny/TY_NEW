<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cardpay.pccredit.report.dao.CustomerTransferFlowDao">
	
	<resultMap id="ResultMap" type="com.cardpay.pccredit.report.model.CustomerMoveForm">
		<result property="customerId" column="customer_id" />
		<result property="approveId" column="approve_id" />
		<result property="moveId" column="move_id" />
		<result property="status" column="status" />
		<result property="approveGh" column="approve_gh" />
		<result property="approveName" column="approve_name" />
		<result property="moveGh" column="move_gh" />
		<result property="moveName" column="move_name" />
		<result property="chineseName" column="CHINESE_NAME" />
		<result property="certiCode" column="CARD_ID" />
		<result property="rowIndex" column="row_index" />
	</resultMap>
	
	<resultMap id="YffdktjbbFormResultMap" type="com.cardpay.pccredit.report.model.YffdktjbbForm">
		<result property="cname" column="cname" />
		<result property="cardtype" column="cardtype" />
		<result property="prodName" column="prodName" />
		<result property="money" column="money" />
		<result property="baserate" column="baserate" />
		<result property="interest" column="interest" />
		<result property="state" column="state" />
		<result property="busimanager" column="busimanager" />
		<result property="name" column="name" />
		<result property="rowIndex" column="row_index" />
		<result property="accountstate" column="ACCOUNTSTATE" />
	</resultMap>
	
	
	
	<resultMap id="DqzzdktjbbFormResultMap" type="com.cardpay.pccredit.report.model.DqzzdktjbbForm">
		<result property="cname" column="cname" />
		<result property="cardtype" column="cardtype" />
		<result property="prodName" column="prodName" />
		<result property="loandate" column="loandate" />
		<result property="enddate" column="enddate" />
		<result property="money" column="money" />
		<result property="baserate" column="baserate" />
		<result property="qs" column="qs" />
		<result property="bjzh" column="bjzh" />
		<result property="lxzh" column="lxzh" />
		<result property="busimanager" column="busimanager" />
		<result property="name" column="name" />
		<result property="rowIndex" column="row_index" />
	</resultMap>
	
	
	
	<resultMap id="BjjdktjbbFormResultMap" type="com.cardpay.pccredit.report.model.BjjdktjbbForm">
		<result property="cname" column="cname" />
		<result property="cardtype" column="cardtype" />
		<result property="prodName" column="prodName" />
		<result property="appdate" column="appdate" />
		<result property="reqlmt" column="reqlmt" />
		<result property="refuseDate" column="refuseDate" />
		<result property="refuseReason" column="refuseReason" />
		<result property="busimanager" column="busimanager" />
		<result property="name" column="name" />
		<result property="rowIndex" column="row_index" />
	</resultMap>
	
	
	<resultMap id="DkyetjbbFormResultMap" type="com.cardpay.pccredit.report.model.DkyetjbbForm">
		<result property="cname" column="cname" />
		<result property="cardnum" column="cardnum" />
		<result property="prodName" column="prodName" />
		<result property="money" column="money" />
		<result property="interest" column="interest" />
		<result property="loandate" column="loandate" />
		<result property="balamt" column="balamt" />
		<result property="bj" column="bj" />
		<result property="lx" column="lx" />
		<result property="state" column="state" />
		<result property="busimanager" column="busimanager" />
		<result property="instcode" column="instcode" />
		<result property="rowIndex" column="row_index" />
		<result property="accountstate" column="ACCOUNTSTATE" />
	</resultMap>
	
	
	<resultMap id="YqdktjbbFormResultMap" type="com.cardpay.pccredit.report.model.YqdktjbbForm">
		<result property="cname" column="cname" />
		<result property="cardnum" column="cardnum" />
		<result property="contactmobiletel" column="contactmobiletel" />
		<result property="prodName" column="prodName" />
		<result property="money" column="money" />
		<result property="interest" column="interest" />
		<result property="hkze" column="hkze" />
		<result property="hkbj" column="hkbj" />
		<result property="yhlx" column="yhlx" />
		<result property="busimanager" column="busimanager" />
		<result property="instcode" column="instcode" />
		<result property="rowIndex" column="row_index" />
		<result property="Shbj" column="Shbj" />
		<result property="Shlx" column="Shlx" />
	</resultMap>
	
	<resultMap id="YqhkdktjbbFormResultMap" type="com.cardpay.pccredit.report.model.YqhkdktjbbForm">
		<result property="cname" column="cname" />
		<result property="cardnum" column="cardnum" />
		<result property="prodName" column="prodName" />
		<result property="money" column="money" />
		<result property="interest" column="interest" />
		<result property="loandate" column="loandate" />
		<result property="balamt" column="balamt" />
		<result property="bj" column="bj" />
		<result property="lx" column="lx" />
		<result property="state" column="state" />
		<result property="busimanager" column="busimanager" />
		<result property="instcode" column="instcode" />
		<result property="rowIndex" column="row_index" />
	</resultMap>
	<resultMap id="XdlctjbbForms" type="com.cardpay.pccredit.report.model.XdlctjbbForms">
	    <result property="chinese_name" column="chinese_name" />
	    <result property="card_id" column="card_id" />
	    <result property="PRODUCT_NAME" column="PRODUCT_NAME" />
	    <result property="APPLY_QUOTA" column="APPLY_QUOTA" />
	    <result property="CREATED_TIME" column="CREATED_TIME" />
	    <result property="start_examine_time" column="start_examine_time" />
	    <result property="jkrq" column="jkrq" />
	    <result property="xdsj" column="xdsj" />
	    <result property="display_name" column="display_name" />
	    <result property="teamname" column="teamname" />
	</resultMap>
	<resultMap id="XdlctjbbFormResultMap" type="com.cardpay.pccredit.report.model.XdlctjbbForm">
		<result property="chineseName" column="chineseName" />
		<result property="cardId" column="cardId" />
		<result property="prodName" column="prodName" />
		<result property="applyQuota" column="applyQuota" />
		<result property="createdTime" column="createdTime" />
		<result property="clts" column="clts" />
		<result property="dcr" column="dcr" />
		<result property="dcts" column="dcts" />
		<result property="sdhrq" column="sdhrq" />
		<result property="sdhts" column="sdhts" />
		<result property="dkffjjr" column="dkffjjr" />
		<result property="totalNum" column="totalNum" />
		<result property="custManager" column="custManager" />
		<result property="name" column="name" />
		<result property="rowIndex" column="row_index" />
	</resultMap>

   <resultMap id="CollectResultMap" type="com.cardpay.pccredit.report.model.AccLoanCollectInfo">
	    <result property="rowIndex" column="rowindex" />
	    <result property="increaseLoancount" column="increaseLoancount" />
	    <result property="loanCustomerSum" column="loanCustomerSum" />
	    <result property="increaseCusSum" column="increaseCusSum" />
	    <result property="centreLoansSun" column="centreLoansSun" />
	    <result property="loanBalanceSum" column="loanBalanceSum" />
	    <result property="contAmt" column="contAmt" />
	    <result property="contBalace" column="contBalace" />
	    <result property="increaseLoanCredit" column="increaseLoanCredit" />
	    <result property="increaseBalanceTheMonth" column="increaseBalanceTheMonth" />
	    <result property="overdueBalanceTheMon" column="overdueBalanceTheMon" />
	    <result property="overdueBalance" column="overdueBalance" />
	    <result property="increseOverdueCusTheMon" column="increseOverdueCusTheMon" />
	    <result property="alloverdue" column="alloverdue" />
	    <result property="resvIntAccum" column="resvIntAccum" />
	    <result property="overdueCusM0" column="overdueCusM0" />
	    <result property="overdueCusM1" column="overdueCusM1" />
	    <result property="overdueCusM2" column="overdueCusM2" />
	    <result property="overdueCusM3" column="overdueCusM3" />
	    <result property="overdueCusM4" column="overdueCusM4" />
	    
	    <result property="xy" column="xy" />
	    <result property="bz" column="bz" />
	    <result property="dy" column="dy" />
	 </resultMap>
	 
   <resultMap id="tkmxFormResultMap" type="com.cardpay.pccredit.report.model.TkmxLszBasic">
	    <result property="CHINESE_NAME" column="CHINESE_NAME" />
	    <result property="CARD_ID" column="CARD_ID" />
	    <result property="CPMC" column="CPMC" />
	    <result property="FFJE" column="FFJE" />
	    <result property="HTLL" column="HTLL" />
	    <result property="QXRQ" column="QXRQ" />
	    <result property="KHJL" column="KHJL" />
	    <result property="BLJG" column="BLJG" />
	    <result property="JF" column="JF" />
	    <result property="JZLL" column="JZLL" />
	    <result property="JZRQ" column="JZRQ" />
	    <result property="DKYE" column="DKYE" />
	    <result property="YWJG" column="YWJG" />
	    <result property="TELEPHONE" column="TELEPHONE" />
	    <result property="DF" column="DF" />
	    <result property="BXHJ" column="BXHJ" />
	    <result property="JE" column="JE" />
	    <result property="YHLX" column="YHLX" />
	    <result property="hkr" column="hkr" />
	    <result property="JKRQ" column="JKRQ" />
	    <result property="APPLY_QUOTA" column="APPLY_QUOTA" />
	    <result property="AUDIT_TIME" column="AUDIT_TIME" />
	    <result property="REFUSAL_REASON" column="REFUSAL_REASON" />
	    <result property="DISPLAY_NAME" column="DISPLAY_NAME" />
	    <result property="BLJG" column="BLJG" />
	    <result property="ACCOUNT_STATUS" column="ACCOUNT_STATUS" />
	     <result property="Shbj" column="Shbj" />
	      <result property="Shlx" column="Shlx" />
	 </resultMap>
  

  

	<select id="findCustomerTransferList" resultMap="ResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.CustomerMoveFilter">
	SELECT * FROM
	(SELECT ROW_.*,ROWNUM ROWNUM_
	FROM (
	select move.*,base.CHINESE_NAME,base.CARD_ID
	from
	TY_CUSTOMER_MOVE move,
	BASIC_CUSTOMER_INFORMATION base
	WHERE 1=1 and base.ID = move.CUSTOMER_ID and move.status ='2'
	<if test="certiCode != null and certiCode != '' ">
		AND base.CARD_ID=#{certiCode}
	</if>

	<if test="customerName != null and customerName != '' ">
		AND base.CHINESE_NAME=#{customerName}
	</if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findCustomerMoveCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.CustomerMoveFilter">
		 select count(*) from TY_CUSTOMER_MOVE move,
					 	      BASIC_CUSTOMER_INFORMATION base
		 WHERE 1=1 and base.ID = move.CUSTOMER_ID and move.status ='2'
		<if test="certiCode != null and certiCode != '' ">
			AND base.CARD_ID=#{certiCode}
		</if>
					 
		<if test="customerName != null and customerName != '' ">
		    AND base.CHINESE_NAME=#{customerName}
		</if>
	</select>
	
	
	<select id="getCustomerMovelList" resultMap="ResultMap"
			parameterType="com.cardpay.pccredit.report.filter.CustomerMoveFilter">
 		select move.*,base.CHINESE_NAME,base.CARD_ID,ROWNUM row_index from TY_CUSTOMER_MOVE move,
					 			   BASIC_CUSTOMER_INFORMATION base 
					  WHERE 1=1 and base.ID = move.CUSTOMER_ID and move.status ='2'
					<if test="certiCode != null and certiCode != '' ">
						AND base.CARD_ID=#{certiCode}
					</if>
					 
					<if test="customerName != null and customerName != '' ">
						AND base.CHINESE_NAME=#{customerName}
					</if>

 	</select>
 	
 	
 	<!-- 已发放贷款统计 -->
 	<select id="findYffdktjbbFormList" resultMap="tkmxFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					<!-- select distinct tkmx.ywbh, b.CHINESE_NAME ,b.CARD_ID, prod.product_name as CPMC,tkmx.FFJE,tkmx.HTLL ,yehz.QXRQ, app.ACCOUNT_STATUS, sysuser.display_name as KHJL,department.NAME as BLJG 
                        from TY_REPAY_TKMX  tkmx, 
                        basic_customer_information  b,
                        ty_customer_base           c,
                        ty_repay_yehz yehz,
                        sys_user sysuser,
                        product_attribute prod,
                        customer_application_info app,
                        SYS_DEPT_USER deptuser,
                        SYS_DEPARTMENT department
                        WHERE 
                        b.ty_customer_id = c.id and
                        c.khnm = tkmx.khh  and
                        yehz.JJH = tkmx.JJH and
                        sysuser.id = b.user_id and
                        app.product_id = prod.id and
                        app.customer_id = b.id  and
                        sysuser.id=deptuser.USER_ID and
                        deptuser.DEPT_ID=department.id  -->
             
	      select   distinct tkmx.ywbh,base.khmc as CHINESE_NAME ,base.ZJHM as CARD_ID, protype.product_name as CPMC,tkmx.FFJE,tkmx.JZLL ,yehz.QXRQ,  sysuser.display_name as KHJL,DeptName.Name as BLJG,tkmx.jkrq
	   from
	                   
	                   ( select distinct t.name,sysuser.id from sys_department t,sys_dept_user tt,sys_user sysuser
	              where 
	                    t.id=tt.dept_id and 
	                    sysuser.id=tt.user_id)  DeptName,
	                    ty_customer_rygl rygl,
	                    ty_customer_base base,
	                     ty_product_type protype,
	                    ty_repay_tkmx tkmx,
	                    ty_repay_lsz lsz,
	                    SYS_USER sysuser  ,
	                    ty_kdk_jh jh,
	                    ty_repay_yehz yehz
	                    WHERE 
	                    base.khjl=rygl.dm 
	                    and rygl.ddrq=sysuser.external_id
	                    and base.khnm=tkmx.khh
	                    and tkmx.JJH=yehz.JJH
	                    and protype.product_code=tkmx.cpmc
	                    and lsz.jjh=tkmx.jjh
	                    and jh.ywbh=tkmx.ywbh||'HT'
	                    and DeptName.id=sysuser.id
                    
               <if test="certiCode != null and certiCode != '' ">
						 and base.zjhm=#{certiCode}
					</if>
								 
					<if test="customerName != null and customerName != '' ">
					    and base.khmc=#{customerName}
					</if>
					
					<if test="organName != null and organName != '' ">
					    AND DeptName.Name=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name=#{custManagerName}
					</if>
					
					<if test="status != null and status != '' ">
						AND app.ACCOUNT_STATUS=#{status}
					</if> 
					 order by tkmx.jkrq desc
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	
	<select id="getYffdktjbbFormlList" resultMap="YffdktjbbFormResultMap"
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					<!--  app.ACCOUNT_STATUS  as state,prod.product_name as prodName -->
 		 			select distinct  base.khmc as cname ,base.zjhm as cardtype,protype.product_name as prodName,tkmx.FFJE as money,tkmx.JZLL as baserate,yehz.QXRQ as interest, sysuser.display_name as busimanager,DeptName.Name  as name 
		                   from
	                   
	                   ( select distinct t.name,sysuser.id from sys_department t,sys_dept_user tt,sys_user sysuser
	              where 
	                    t.id=tt.dept_id and 
	                    sysuser.id=tt.user_id)  DeptName,
	                    ty_customer_rygl rygl,
	                    ty_customer_base base,
	                     ty_product_type protype,
	                    ty_repay_tkmx tkmx,
	                    ty_repay_lsz lsz,
	                    SYS_USER sysuser  ,
	                    ty_kdk_jh jh,
	                    ty_repay_yehz yehz
	                    WHERE 
	                    base.khjl=rygl.dm 
	                    and rygl.ddrq=sysuser.external_id
	                    and base.khnm=tkmx.khh
	                    and tkmx.JJH=yehz.JJH
	                    and protype.product_code=tkmx.cpmc
	                    and lsz.jjh=tkmx.jjh
	                    and jh.ywbh=tkmx.ywbh||'HT'
	                    and DeptName.id=sysuser.id
                    
               <if test="certiCode != null and certiCode != '' ">
						 and base.zjhm=#{certiCode}
					</if>
								 
					<if test="customerName != null and customerName != '' ">
					    and base.khmc=#{customerName}
					</if>
					
					<if test="organName != null and organName != '' ">
					    AND DeptName.Name=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name=#{custManagerName}
					</if>
					
					<if test="status != null and status != '' ">
						AND app.ACCOUNT_STATUS=#{status}
					</if> 
 	</select>
	
	<select id="findYffdktjbbFormCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
		  select  count(distinct tkmx.ywbh)
                 from
	                   
	                   ( select distinct t.name,sysuser.id from sys_department t,sys_dept_user tt,sys_user sysuser
	              where 
	                    t.id=tt.dept_id and 
	                    sysuser.id=tt.user_id)  DeptName,
	                    ty_customer_rygl rygl,
	                    ty_customer_base base,
	                     ty_product_type protype,
	                    ty_repay_tkmx tkmx,
	                    ty_repay_lsz lsz,
	                    SYS_USER sysuser  ,
	                    ty_kdk_jh jh,
	                    ty_repay_yehz yehz
	                    WHERE 
	                    base.khjl=rygl.dm 
	                    and rygl.ddrq=sysuser.external_id
	                    and base.khnm=tkmx.khh
	                    and tkmx.JJH=yehz.JJH
	                    and protype.product_code=tkmx.cpmc
	                    and lsz.jjh=tkmx.jjh
	                    and jh.ywbh=tkmx.ywbh||'HT'
	                    and DeptName.id=sysuser.id
                    
               <if test="certiCode != null and certiCode != '' ">
						 and base.zjhm=#{certiCode}
					</if>
								 
					<if test="customerName != null and customerName != '' ">
					    and base.khmc=#{customerName}
					</if>
					
					<if test="organName != null and organName != '' ">
					    AND DeptName.Name=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name=#{custManagerName}
					</if>
					
					<if test="status != null and status != '' ">
						AND app.ACCOUNT_STATUS=#{status}
					</if> 
	</select>
	
	<!-- 被拒绝贷款统计 -->
	<select id="findbjjdktjbbFormList" resultMap="tkmxFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					 <!-- select * from bjjdktjbb a WHERE 1=1 -->
					         select
                  b.chinese_name as CHINESE_NAME,
                  info.card_id as CARD_ID,
                  prod.product_name as CPMC,
                  to_char(app.created_time,'yyyy-MM-dd') as JKRQ,
                  app.apply_quota as APPLY_QUOTA ,
                  to_char(pro.audit_time,'yyyy-MM-dd') as AUDIT_TIME,
                  pro.refusal_reason as REFUSAL_REASON,
                  sysuser.display_name as DISPLAY_NAME,
                  (select t.name from
                  sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
                  where tt.user_id = sysuser.id))as BLJG
                from BASIC_CUSTOMER_INFORMATION b,
                 customer_application_info app,
                  basic_customer_information info,
                  product_attribute prod,
                  customer_application_process pro,
                  sys_user sysuser
                where   app.customer_id = b.id 
                and app.customer_id = info.id 
                  and app.product_id = prod.id
                  and app.id = pro.application_id
                  and b.user_id=sysuser.id
                  and app.status ='refuse'
					<if test="certiCode != null and certiCode != '' ">
						AND b.CARD_ID=#{certiCode}
					</if>
					<if test="custManagerName != null and custManagerName != '' ">
					    AND sysuser.DISPLAY_NAME=#{custManagerName}
					</if>
					<if test="organName != null and organName != '' ">
					    AND  (select t.name from
                  sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
                  where tt.user_id = sysuser.id))=#{organName}
					</if>
					
					
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findbjjdktjbbFormCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
		   select
                count(*)
                from BASIC_CUSTOMER_INFORMATION b,
                 customer_application_info app,
                  basic_customer_information info,
                  product_attribute prod,
                  customer_application_process pro,
                  sys_user sysuser
                where   app.customer_id = b.id 
                and app.customer_id = info.id 
                  and app.product_id = prod.id
                  and app.id = pro.application_id
                  and b.user_id=sysuser.id
                  and app.status ='refuse'
					<if test="certiCode != null and certiCode != '' ">
						AND b.CARD_ID=#{certiCode}
					</if>
					<if test="custManagerName != null and custManagerName != '' ">
					    AND sysuser.DISPLAY_NAME=#{custManagerName}
					</if>
					<if test="organName != null and organName != '' ">
					    AND (select t.name from
                  sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
                  where tt.user_id = sysuser.id))=#{organName}
					</if>
		
	</select>
	
	
	<select id="getbjjdktjbbFormList" resultMap="BjjdktjbbFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					 select a.*,ROWNUM row_index from bjjdktjbb a WHERE 1=1 
					<if test="certiCode != null and certiCode != '' ">
						AND a.cardtype=#{certiCode}
					</if>
					<if test="customerName != null and customerName != '' ">
					    AND a.cname=#{customerName}
					</if>
					<if test="organName != null and organName != '' ">
					    AND a.name=#{organName}
					</if>
					<if test="custManagerName != null and custManagerName != '' ">
						AND a.busimanager=#{custManagerName}
					</if>
	</select>
	
	<!--获取贷款到期的时间  -->
	 <select id="finddqrq" resultType="String" >
					 select tkmx.DQRQ
				          from BASIC_CUSTOMER_INFORMATION  b,TY_REPAY_TKMX tkmx ,TY_REPAY_LSZ lsz,TY_REPAY_YEHZ yehz,ty_customer_base c,TY_KDK_JH  jh
				          where  b.ty_customer_id = c.id and
				               c.KHNM = tkmx.khh  and
				               lsz.JJH=tkmx.JJH and
				               yehz.JJH = tkmx.JJH
				</select>	
	
	
	<!-- 到期终止贷款统计 -->
	<select id="findDqzzdktjbbFormList" resultMap="tkmxFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
                      <!--  select distinct c.khmc as CHINESE_NAME,c.zjhm as CARD_ID,protype.product_name as CPMC,yehz.qxrq as JZRQ,tkmx.DQRQ,tkmx.ffje as DF,tkmx.JZLL,jh.QS,sysuser.display_name as KHJL,
           (select t.name from sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
                  where tt.user_id = sysuser.id))as YWJG,
                   shlx.df as YHLX,shbj.df as JE
                  from
                    ( select c.zjhm  as cardid,
                  max(to_number(jh.qs)) as qs
                  from ty_customer_rygl rygl,
                    TY_REPAY_TKMX tkmx ,
                    TY_REPAY_YEHZ yehz,
                    ty_product_type protype,
                    ty_customer_base c,
                    TY_KDK_JH  jh, 
                    sys_user sysuser
                  where   c.khjl=rygl.dm  and
                       rygl.ddrq=sysuser.external_id and
                       c.KHNM = tkmx.khh  and
                        protype.product_code=tkmx.cpmc and
                       yehz.JJH = tkmx.JJH  and  
                      jh.ywbh=tkmx.ywbh||'HT' 
                      group by  c.zjhm )  maxqs,
              (select sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
              ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where c.khjl=rygl.dm  and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
              
              group by   tkmx.ywbh , c.zjhm ) shlx,   
              
              (select sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
              ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where c.khjl=rygl.dm  and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              
              and (lsz.zy='批量自动扣本金'
             or lsz.zy='贷款柜台提前还款')
              group by   tkmx.ywbh , c.zjhm) shbj,
                   ty_customer_rygl rygl,
                    TY_REPAY_TKMX tkmx ,
                    TY_REPAY_YEHZ yehz,
                    ty_product_type protype,
                    ty_customer_base c,
                    TY_KDK_JH  jh, 
                    sys_user sysuser
                  where
                    c.khjl=rygl.dm  and
                    rygl.ddrq=sysuser.external_id and
                       c.KHNM = tkmx.khh  and
                        protype.product_code=tkmx.cpmc and
                       yehz.JJH = tkmx.JJH  and  
                       jh.ywbh=tkmx.ywbh||'HT' and
                        maxqs.cardid=c.zjhm and
                      maxqs.qs=jh.qs and
                       shlx.ywbh=tkmx.ywbh and
                       shlx.zjhm=c.zjhm and
                       shbj.ywbh=tkmx.ywbh and
                       shbj.zjhm=c.zjhm and
				    tkmx.jqrq is not null and
				    tkmx.jqrq  <![CDATA[ <=  ]]>tkmx.Dqrq -->
					select distinct c.khmc as CHINESE_NAME,c.zjhm as
					CARD_ID,protype.product_name as CPMC,yehz.qxrq as
					JZRQ,tkmx.DQRQ,tkmx.ffje as DF,tkmx.JZLL,jh.QS,sysuser.display_name as
					KHJL,
					(select t.name from sys_department t where t.id in (select tt.dept_id from
					sys_dept_user tt
					where tt.user_id = sysuser.id))as YWJG,
					shlx.df as YHLX,shbj.df as JE
					from
					( select c.zjhm as cardid,
					max(to_number(jh.qs)) as qs,
					max(to_number(lsz.jzrq)) as maxjzrq
					from ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_product_type protype,
					ty_customer_base c,
					TY_KDK_JH jh,
					ty_repay_lsz lsz,
					sys_user sysuser
					where c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					protype.product_code=tkmx.cpmc and
					tkmx.jjh=lsz.jjh and
					yehz.JJH = tkmx.JJH and
					jh.ywbh=tkmx.ywbh||'HT'
					group by c.zjhm ) maxqs,
					(select sum(lsz.df) as df ,
					tkmx.ywbh ,
					c.zjhm
					from
					ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_repay_lsz lsz,
					ty_customer_base c,
					ty_product_type protype,
					sys_user sysuser
					where c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					yehz.JJH = tkmx.JJH and
					protype.product_code=tkmx.cpmc and
					lsz.jjh=tkmx.jjh
					and lsz.zy='批量自动扣利息'
				
					group by tkmx.ywbh , c.zjhm ) shlx,
				
					(select sum(lsz.df) as df ,
					tkmx.ywbh ,
					c.zjhm
					from
					ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_repay_lsz lsz,
					ty_customer_base c,
					ty_product_type protype,
					sys_user sysuser
					where c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					yehz.JJH = tkmx.JJH and
					protype.product_code=tkmx.cpmc and
					lsz.jjh=tkmx.jjh
				
					and (lsz.zy='批量自动扣本金'
					or lsz.zy='贷款柜台提前还款')
					group by tkmx.ywbh , c.zjhm) shbj,
					ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_product_type protype,
					ty_customer_base c,
					TY_KDK_JH jh,
					sys_user sysuser
					where
					c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					protype.product_code=tkmx.cpmc and
					yehz.JJH = tkmx.JJH and
					jh.ywbh=tkmx.ywbh||'HT' and
					maxqs.cardid=c.zjhm and
					maxqs.qs=jh.qs and
					shlx.ywbh=tkmx.ywbh and
					shlx.zjhm=c.zjhm and
					shbj.ywbh=tkmx.ywbh and
					shbj.zjhm=c.zjhm and
					maxqs.maxjzrq  <![CDATA[ <=  ]]>tkmx.Dqrq
					<if test="certiCode != null and certiCode != '' ">
						AND c.zjhm=#{certiCode}
					</if>
				
					<if test="customerName != null and customerName != '' ">
						AND c.khmc=#{customerName}
					</if>
				
					<if test="organName != null and organName != '' ">
						AND (select t.name from
						sys_department t where t.id in
						(select tt.dept_id from sys_dept_user tt
						where tt.user_id =
						sysuser.id))=#{organName}
					</if>
				
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name =#{custManagerName}
					</if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findDqzzdktjbbFormCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
		   select count(ywbh)
      from
                    ( select distinct  tkmx.ywbh
					from
					( select c.zjhm as cardid,
					max(to_number(jh.qs)) as qs,
					max(to_number(lsz.jzrq)) as maxjzrq
					from ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_product_type protype,
					ty_customer_base c,
					TY_KDK_JH jh,
					ty_repay_lsz lsz,
					sys_user sysuser
					where c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					protype.product_code=tkmx.cpmc and
					tkmx.jjh=lsz.jjh and
					yehz.JJH = tkmx.JJH and
					jh.ywbh=tkmx.ywbh||'HT'
					group by c.zjhm ) maxqs,
					(select sum(lsz.df) as df ,
					tkmx.ywbh ,
					c.zjhm
					from
					ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_repay_lsz lsz,
					ty_customer_base c,
					ty_product_type protype,
					sys_user sysuser
					where c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					yehz.JJH = tkmx.JJH and
					protype.product_code=tkmx.cpmc and
					lsz.jjh=tkmx.jjh
					and lsz.zy='批量自动扣利息'
				
					group by tkmx.ywbh , c.zjhm ) shlx,
				
					(select sum(lsz.df) as df ,
					tkmx.ywbh ,
					c.zjhm
					from
					ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_repay_lsz lsz,
					ty_customer_base c,
					ty_product_type protype,
					sys_user sysuser
					where c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					yehz.JJH = tkmx.JJH and
					protype.product_code=tkmx.cpmc and
					lsz.jjh=tkmx.jjh
				
					and (lsz.zy='批量自动扣本金'
					or lsz.zy='贷款柜台提前还款')
					group by tkmx.ywbh , c.zjhm) shbj,
					ty_customer_rygl rygl,
					TY_REPAY_TKMX tkmx ,
					TY_REPAY_YEHZ yehz,
					ty_product_type protype,
					ty_customer_base c,
					TY_KDK_JH jh,
					sys_user sysuser
					where
					c.khjl=rygl.dm and
					rygl.ddrq=sysuser.external_id and
					c.KHNM = tkmx.khh and
					protype.product_code=tkmx.cpmc and
					yehz.JJH = tkmx.JJH and
					jh.ywbh=tkmx.ywbh||'HT' and
					maxqs.cardid=c.zjhm and
					maxqs.qs=jh.qs and
					shlx.ywbh=tkmx.ywbh and
					shlx.zjhm=c.zjhm and
					shbj.ywbh=tkmx.ywbh and
					shbj.zjhm=c.zjhm and
					maxqs.maxjzrq  <![CDATA[ <=  ]]>tkmx.Dqrq
					<if test="certiCode != null and certiCode != '' ">
			AND c.zjhm=#{certiCode}
		</if>
					 
		<if test="customerName != null and customerName != '' ">
		    AND  c.khmc=#{customerName}
		</if>
		
		<if test="organName != null and organName != '' ">
		 	AND (select t.name from
                  sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
                  where tt.user_id = sysuser.id))=#{organName}
		</if>
		
		<if test="custManagerName != null and custManagerName != '' ">
			AND sysuser.display_name =#{custManagerName}
		</if>)
	</select>
	
	
	<select id="getDqzzdktjbbFormList" resultMap="DqzzdktjbbFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					 select distinct c.khmc as cname,c.zjhm as cardtype,protype.product_name as prodName,yehz.qxrq as loandate,tkmx.DQRQ as enddate,tkmx.ffje as money,tkmx.HTLL as baserate,jh.QS as qs, jh.JE as bjzh,jh.YHLX as lxzh,sysuser.display_name as busimanager,
					   (select t.name from sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
                  where tt.user_id = sysuser.id)) as name
                from
                    ( select c.zjhm  as cardid,
                  max(to_number(jh.qs)) as qs
                  from ty_customer_rygl rygl,
                    TY_REPAY_TKMX tkmx ,
                    TY_REPAY_YEHZ yehz,
                    ty_product_type protype,
                    ty_customer_base c,
                    TY_KDK_JH  jh, 
                    sys_user sysuser
                  where   c.khjl=rygl.dm  and
                       rygl.ddrq=sysuser.external_id and
                       c.KHNM = tkmx.khh  and
                        protype.product_code=tkmx.cpmc and
                       yehz.JJH = tkmx.JJH  and  
                      jh.ywbh=tkmx.ywbh||'HT' 
                      group by  c.zjhm )  maxqs,
              (select sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
              ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where c.khjl=rygl.dm  and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
              
              group by   tkmx.ywbh , c.zjhm ) shlx,   
              
              (select sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
              ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where c.khjl=rygl.dm  and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              
              and (lsz.zy='批量自动扣本金'
             or lsz.zy='贷款柜台提前还款')
              group by   tkmx.ywbh , c.zjhm) shbj,
                   ty_customer_rygl rygl,
                    TY_REPAY_TKMX tkmx ,
                    TY_REPAY_YEHZ yehz,
                    ty_product_type protype,
                    ty_customer_base c,
                    TY_KDK_JH  jh, 
                    sys_user sysuser
                  where
                    c.khjl=rygl.dm  and
                    rygl.ddrq=sysuser.external_id and
                       c.KHNM = tkmx.khh  and
                        protype.product_code=tkmx.cpmc and
                       yehz.JJH = tkmx.JJH  and  
                      -- substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
                       jh.ywbh=tkmx.ywbh||'HT' and
                        maxqs.cardid=c.zjhm and
                      maxqs.qs=jh.qs and
                       shlx.ywbh=tkmx.ywbh and
                       shlx.zjhm=c.zjhm and
                       shbj.ywbh=tkmx.ywbh and
                       shbj.zjhm=c.zjhm and
                      tkmx.jqrq is not null and
                    tkmx.jqrq <![CDATA[ <=  ]]>tkmx.Dqrq 
					<if test="certiCode != null and certiCode != '' ">
			AND c.zjhm=#{certiCode}
		</if>
					 
		<if test="customerName != null and customerName != '' ">
		    AND  c.khmc=#{customerName}
		</if>
		
		<if test="organName != null and organName != '' ">
		 	AND (select t.name from
                  sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
                  where tt.user_id = sysuser.id))=#{organName}
		</if>
		
		<if test="custManagerName != null and custManagerName != '' ">
			AND sysuser.display_name =#{custManagerName}
		</if>
	</select>
	
	<!-- 贷款余额统计 -->
	<select id="findDkyetjbbFormList" resultMap="tkmxFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					<!--  select a.*,trim(a.state) as ACCOUNTSTATE from dkyetjbb a WHERE 1=1  -->
						   <!--  select distinct tkmx.ywbh, b.CHINESE_NAME,b.CARD_ID, protype.product_name as CPMC,tkmx.ffje
              as JF,tkmx.HTLL,yehz.qxrq as
              jzrq,yehz.DKYE,yehz.Shbj,yehz.Shlx,sysuser.display_name
              as KHJL
              ,(select org.name from sys_organization org where id in(select t.org_id from
              sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
              where tt.user_id = sysuser.id))) as YWJG
              from BASIC_CUSTOMER_INFORMATION b,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where b.ty_customer_id = c.id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              sysuser.id=b.user_id  -->
              select distinct tkmx.ywbh, c.khmc as CHINESE_NAME,c.zjhm as CARD_ID,tkmx.jkrq, protype.product_name as CPMC,tkmx.ffje
              as JF,tkmx.JZLL,yehz.qxrq as
              jzrq,yehz.DKYE,sysuser.display_name as KHJL
              ,(select t.name from sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
              where tt.user_id = sysuser.id)) as YWJG,
              shlx.df as shlx,shbj.df as Shbj
              from
              (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
              (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser,
              ty_kdk_jh jh
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh and
              jh.ywbh=tkmx.ywbh||'HT' and
              shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=c.zjhm and
              shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=C.Zjhm
					<if test="certiCode != null and certiCode != '' ">
						AND c.zjhm=#{certiCode}
					</if>
					
					<if test="organName != null and organName != '' ">
					 	AND (select t.name from
              sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
              where tt.user_id = sysuser.id))=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name=#{custManagerName}
					</if>
					<if test="status != null and status != '' ">
						AND app.ACCOUNT_STATUS=#{status}
					</if> 
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findDkyetjbbFormCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
		 select count(distinct tkmx.ywbh) 
              from
              (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
              (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser,
              ty_kdk_jh jh
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh and
              jh.ywbh=tkmx.ywbh||'HT' and
              shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=c.zjhm and
              shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=C.Zjhm
					<if test="certiCode != null and certiCode != '' ">
						AND c.zjhm=#{certiCode}
					</if>
					
					<if test="organName != null and organName != '' ">
					 	AND (select t.name from
              sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
              where tt.user_id = sysuser.id))=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name=#{custManagerName}
					</if>
					<if test="status != null and status != '' ">
						AND app.ACCOUNT_STATUS=#{status}
					</if> 
	</select>
	
	<select id="getDkyetjbbFormList" resultMap="DkyetjbbFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					 select distinct tkmx.ywbh, c.khmc as cname,c.zjhm as cardnum,tkmx.CPMC as prodName,tkmx.ffje as money
		          ,tkmx.JZLL as interest,yehz.qxrq as loandate,yehz.DKYE as balamt,yehz.Shbj as bj,yehz.Shlx as lx,sysuser.display_name as busimanager
		          ,(select t.name from
		          sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
		          where tt.user_id = sysuser.id)) as instcode
				 from
              (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
              (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser,
              ty_kdk_jh jh
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh and
              jh.ywbh=tkmx.ywbh||'HT' and
              shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=c.zjhm and
              shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=C.Zjhm
					<if test="certiCode != null and certiCode != '' ">
						AND c.zjbh=#{certiCode}
					</if>
					<if test="organName != null and organName != '' ">
					 	AND (select t.name from
              sys_department t where t.id in (select tt.dept_id from sys_dept_user tt
              where tt.user_id = sysuser.id))=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name=#{custManagerName}
					</if>
					<if test="status != null and status != '' ">
						AND app.ACCOUNT_STATUS=#{status}
					</if> 
	</select>
	
	<!-- 逾期贷款统计 -->
	<select id="findYqdktjbbFormList" resultMap="tkmxFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					 <!-- select * from yqdktjbb a WHERE 1=1  -->
  <!--  select CHINESE_NAME, CARD_ID, TELEPHONE,  CPMC, DF,JZLL, BXHJ, JE, KHJL, YWJG from
 ( select
          b.khmc as CHINESE_NAME,b.zjhm as CARD_ID,b.SJ as TELEPHONE, protype.product_name as CPMC,tkmx.ffje as DF,tkmx.JZLL,bxhj.bx as BXHJ,yehz.dkye as JE,sysuser.display_name as KHJL,(select t.name from
              sys_department t where t.id in (select tt.dept_id 
        from sys_dept_user tt
              where tt.user_id = sysuser.id))
                as YWJG,
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS
         
       from
           (   select 
              tkmx.ywbh,
              sum(lsz.df) as bx from  
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh 
              group by tkmx.ywbh)bxhj,
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              bxhj.ywbh=tkmx.ywbh
              group by  b.khmc,b.zjhm,b.SJ , protype.product_name ,tkmx.ffje ,tkmx.JZLL,sysuser.display_name ,sysuser.id,tkmx.dqrq,bxhj.bx,yehz.dkye) a
              where 1=1 and
               (nvl(a.DELAYINTERESTDAYS,0)  >   0 or nvl(a.DELAYAMTDAYS,0)  >   0) -->
               select CHINESE_NAME, CARD_ID, TELEPHONE,  CPMC, DF,JZLL, BXHJ,JE,  Shbj,Shlx, KHJL, YWJG from
 ( select
          b.khmc as CHINESE_NAME,b.zjhm as CARD_ID,b.SJ as TELEPHONE, protype.product_name as CPMC,tkmx.ffje as DF,tkmx.JZLL,bxhj.bx as BXHJ,yehz.dkye as JE,yhbj.yhbj as Shbj,bxhj.bx-yhbj.yhbj as Shlx,sysuser.display_name as KHJL,(select t.name from
              sys_department t where t.id in (select tt.dept_id 
        from sys_dept_user tt
              where tt.user_id = sysuser.id))
                as YWJG,
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS
         
       from
           (   select 
              tkmx.ywbh,
              sum(lsz.df) as bx from  
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh 
              group by tkmx.ywbh)bxhj,
               (   select 
              tkmx.ywbh,
              sum(lsz.df) as yhbj from  
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh  and
              (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款'
            or lsz.zy='批量贷款自动扣本金' )
              group by tkmx.ywbh)yhbj,
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              bxhj.ywbh=tkmx.ywbh and
              yhbj.ywbh=tkmx.ywbh
              group by  b.khmc,b.zjhm,b.SJ , protype.product_name ,tkmx.ffje ,tkmx.JZLL,sysuser.display_name ,sysuser.id,tkmx.dqrq,bxhj.bx,yehz.dkye,yhbj.yhbj) a
              where 1=1 and
               (nvl(a.DELAYINTERESTDAYS,0)  >   0 or nvl(a.DELAYAMTDAYS,0)  >   0) 
					<if test="certiCode != null and certiCode != '' ">
						AND a.CARD_ID=#{certiCode}
					</if>
					
					<if test="organName != null and organName != '' ">
					    AND a.YWJG=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND a.KHJL=#{custManagerName}
					</if>
		 			<![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	
	<select id="getYqdktjbbFormList" resultMap="YqdktjbbFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					 select   cname, cardnum, contactmobiletel, prodName, money, interest, hkze, hkbj, Shbj,Shlx, busimanager, instcode
           from ( 
         select
          b.khmc as cname,b.zjhm as cardnum,b.SJ as contactmobiletel, protype.product_name as prodName,tkmx.ffje as money,tkmx.JZLL as interest,bxhj.bx as hkze,yehz.dkye as hkbj,yhbj.yhbj as Shbj,bxhj.bx-yhbj.yhbj as Shlx,
          sysuser.display_name as busimanager,
          (select t.name from sys_department t where t.id in (select tt.dept_id  from sys_dept_user tt where tt.user_id = sysuser.id)) as instcode,
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS
       from
           (   select 
              tkmx.ywbh,
              sum(lsz.df) as bx from  
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh 
              group by tkmx.ywbh)bxhj,
               (   select 
              tkmx.ywbh,
              sum(lsz.df) as yhbj from  
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh  and
              (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款'
            or lsz.zy='批量贷款自动扣本金' )
              group by tkmx.ywbh)yhbj,
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              bxhj.ywbh=tkmx.ywbh and
              yhbj.ywbh=tkmx.ywbh
              group by  b.khmc,b.zjhm,b.SJ , protype.product_name ,tkmx.ffje ,tkmx.JZLL,sysuser.display_name ,sysuser.id,tkmx.dqrq,bxhj.bx,yehz.dkye,yhbj.yhbj) a
              where 1=1 and
               (nvl(a.DELAYINTERESTDAYS,0)  >   0 or nvl(a.DELAYAMTDAYS,0)  >   0)
					<if test="certiCode != null and certiCode != '' ">
						AND cardnum=#{certiCode}
					</if>
					
					<if test="organName != null and organName != '' ">
					    AND instcode=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND busimanager=#{custManagerName}
					</if>
	</select>
	
	
	<select id="findYqdktjbbFormCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
		 <!-- select count(*) from yqdktjbb a WHERE 1=1  -->
		 select count(*)
		 from (select CHINESE_NAME, CARD_ID, TELEPHONE,  CPMC, DF,JZLL, BXHJ, JE, KHJL, YWJG from
 ( select
          b.khmc as CHINESE_NAME,b.zjhm as CARD_ID,b.SJ as TELEPHONE, protype.product_name as CPMC,tkmx.ffje as DF,tkmx.JZLL,bxhj.bx as BXHJ,yehz.dkye as JE,sysuser.display_name as KHJL,(select t.name from
              sys_department t where t.id in (select tt.dept_id 
        from sys_dept_user tt
              where tt.user_id = sysuser.id))
                as YWJG,
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS
         
       from
           (   select 
              tkmx.ywbh,
              sum(lsz.df) as bx from  
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh 
              group by tkmx.ywbh)bxhj,
              ty_repay_tkmx tkmx,
              ty_product_type protype,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              protype.product_code=tkmx.cpmc and
              b.khnm=tkmx.khh and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              bxhj.ywbh=tkmx.ywbh
              group by  b.khmc,b.zjhm,b.SJ , protype.product_name ,tkmx.ffje ,tkmx.JZLL,sysuser.display_name ,sysuser.id,tkmx.dqrq,bxhj.bx,yehz.dkye) a
              where 1=1 and
               (nvl(a.DELAYINTERESTDAYS,0)  >   0 or nvl(a.DELAYAMTDAYS,0)  >   0)
					<if test="certiCode != null and certiCode != '' ">
						AND a.CARD_ID=#{certiCode}
					</if>
					
					<if test="organName != null and organName != '' ">
					    AND a.YWJG=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND a.KHJL=#{custManagerName}
					</if>)
		<!-- <if test="certiCode != null and certiCode != '' ">
						AND b.CARD_ID=#{certiCode}
					</if>
					
					<if test="organName != null and organName != '' ">
					    AND (
					    select t.name fromsys_department t where t.id in (select tt.dept_id 
       					from sys_dept_user tt
           			   	where tt.user_id = sysuser.id)))=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND sysuser.display_name=#{custManagerName}
					</if> -->
	</select>
	 
	<!--预期还款贷款统计-->
	<select id="findYqhkdktjbbFormList" resultMap="tkmxFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					<!--  select * from yqhkdktjbb a WHERE 1=1 -->
                          <!-- select distinct ywbh, CHINESE_NAME,CARD_ID,CPMC,DF,  nvl(hkr,0.00) as hkr, nvl(JE,0.00) as je,KHJL, YWJG
					 from
					(select distinct tkmx.ywbh, b.khmc as CHINESE_NAME,b.zjhm as CARD_ID,tkmx.CPMC,tkmx.ffje as DF,
					(case when(to_date(tkmx.dqrq,'yyyy-MM-dd')-trunc(sysdate,'dd')) > 0 then (to_date(tkmx.dqrq,'yyyy-MM-dd')-trunc(sysdate,'dd')) else null  end )  as hkr, yehz.dkye as JE,
					 sysuser.display_name as KHJL,
					 (select t.name from sys_department t where t.id in (select tt.dept_id from sys_dept_user tt where tt.user_id = sysuser.id))  as YWJG,
					 (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
					 (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS
						 from 
	                      ty_repay_tkmx tkmx,
	                      ty_product_type protype,
	                      ty_customer_base b,
	                      ty_customer_rygl rygl,
	                      sys_user sysuser,
	                      ty_repay_yehz yehz,
	                      ty_kdk_jh jh,
	                      ty_repay_lsz lsz
	                      where b.khjl=rygl.dm and
	                      rygl.ddrq=sysuser.external_id and
	                      protype.product_code=tkmx.cpmc and
	                      b.khnm=tkmx.khh and
	                      yehz.jjh=tkmx.jjh and
	                      tkmx.jjh =lsz.jjh  and
	                      jh.ywbh=tkmx.ywbh||'HT'
	                      group by   tkmx.ywbh, b.khmc,b.zjhm,tkmx.CPMC,tkmx.ffje ,sysuser.display_name ,tkmx.dqrq,yehz.dkye,sysuser.id
	                      ) a
	                      where 1=1  
	                       and (nvl(a.DELAYINTERESTDAYS,0)  <![CDATA[ <=  ]]>  0 or nvl(a.DELAYAMTDAYS,0)  <![CDATA[ <=  ]]>  0) -->
					select ywbh,chinese_name,card_id,CPMC,DF,hkr,JE,yhlx,KHJL,YWJG from 
			(select tk.ywbh,b.chinese_name,b.card_id,tpt.product_name as CPMC, 
			       tk.ffje as DF,
			       (case when(SUBSTR(lsz.jzrq, 7, 9)- SUBSTR(to_char(trunc(sysdate,'dd'),'yyyymmdd'), 7, 9)) > 0
			        then (SUBSTR(lsz.jzrq, 7, 9)- SUBSTR(to_char(trunc(sysdate,'dd'),'yyyymmdd'), 7, 9)) else 0  end )  as hkr, 
			         jh.je as JE,jh.yhlx,
			          a.display_name as KHJL,
			           (select t.name from sys_department t where t.id in (select tt.dept_id from sys_dept_user tt where tt.user_id = a.id))  as YWJG , 
			           row_number() over (partition by b.chinese_name order by lsz.jzrq desc) cn 
			           from TY_REPAY_LSZ lsz,ty_repay_tkmx tk ,
			           ty_repay_yehz yehz,
			           ty_customer_base base,
			           BASIC_CUSTOMER_INFORMATION b, 
			           SYS_USER a ,
			           ty_kdk_jh jh,
			           ty_product_type tpt
			           where zy = '批量自动扣本金' and 
			           tk.sfjq= '0.0' 
			           and tk.jjh =lsz.jjh 
			           and yehz.jjh=tk.jjh 
			           and base.khnm=tk.khh 
			           and base.id=b.ty_customer_id 
			           and a.id=b.user_id 
			           and jh.ywbh=tk.ywbh||'HT'
			           and tpt.product_code=tk.cpmc
			            and  to_date(tk.dqrq,'yy-mm-dd')>trunc(sysdate) 
			          <!--  and a.id ='8a855a3c5a5ff169015a60012091003a' -->
			           ) where cn=1
					<if test="certiCode != null and certiCode != '' ">
						AND CARD_ID=#{certiCode}
					</if>
					<if test="organName != null and organName != '' ">
					    AND  YWJG=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND KHJL=#{custManagerName}
					</if>
		 			<![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findYqhkdktjbbFormCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
		 select count(*)
		   from  (   select ywbh,chinese_name,card_id,CPMC,DF,hkr,JE,yhlx,KHJL,YWJG from 
			(select tk.ywbh,b.chinese_name,b.card_id,tpt.product_name as CPMC, 
			       tk.ffje as DF,
			       (case when(SUBSTR(lsz.jzrq, 7, 9)- SUBSTR(to_char(trunc(sysdate,'dd'),'yyyymmdd'), 7, 9)) > 0
			        then (SUBSTR(lsz.jzrq, 7, 9)- SUBSTR(to_char(trunc(sysdate,'dd'),'yyyymmdd'), 7, 9)) else 0  end )  as hkr, 
			         jh.je as JE,jh.yhlx,
			          a.display_name as KHJL,
			           (select t.name from sys_department t where t.id in (select tt.dept_id from sys_dept_user tt where tt.user_id = a.id))  as YWJG , 
			           row_number() over (partition by b.chinese_name order by lsz.jzrq desc) cn 
			           from TY_REPAY_LSZ lsz,ty_repay_tkmx tk ,
			           ty_repay_yehz yehz,
			           ty_customer_base base,
			           BASIC_CUSTOMER_INFORMATION b, 
			           SYS_USER a ,
			           ty_kdk_jh jh,
			           ty_product_type tpt
			           where zy = '批量自动扣本金' and 
			           tk.sfjq= '0.0' 
			           and tk.jjh =lsz.jjh 
			           and yehz.jjh=tk.jjh 
			           and base.khnm=tk.khh 
			           and base.id=b.ty_customer_id 
			           and a.id=b.user_id 
			           and jh.ywbh=tk.ywbh||'HT'
			           and tpt.product_code=tk.cpmc
			            and  to_date(tk.dqrq,'yy-mm-dd')>trunc(sysdate) 
			          <!--  and a.id ='8a855a3c5a5ff169015a60012091003a' -->
			           ) where cn=1
					<if test="certiCode != null and certiCode != '' ">
						AND CARD_ID=#{certiCode}
					</if>
					<if test="organName != null and organName != '' ">
					    AND  YWJG=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND KHJL=#{custManagerName}
					</if>)
	</select>
	
	<select id="getYqhkdktjbbFormList" resultMap="tkmxFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					 select ywbh,chinese_name,card_id,CPMC,DF,hkr,JE,yhlx,KHJL,YWJG from 
			(select tk.ywbh,b.chinese_name,b.card_id,tpt.product_name as CPMC, 
			       tk.ffje as DF,
			       (case when(SUBSTR(lsz.jzrq, 7, 9)- SUBSTR(to_char(trunc(sysdate,'dd'),'yyyymmdd'), 7, 9)) > 0
			        then (SUBSTR(lsz.jzrq, 7, 9)- SUBSTR(to_char(trunc(sysdate,'dd'),'yyyymmdd'), 7, 9)) else 0  end )  as hkr, 
			         jh.je as JE,jh.yhlx,
			          a.display_name as KHJL,
			           (select t.name from sys_department t where t.id in (select tt.dept_id from sys_dept_user tt where tt.user_id = a.id))  as YWJG , 
			           row_number() over (partition by b.chinese_name order by lsz.jzrq desc) cn 
			           from TY_REPAY_LSZ lsz,ty_repay_tkmx tk ,
			           ty_repay_yehz yehz,
			           ty_customer_base base,
			           BASIC_CUSTOMER_INFORMATION b, 
			           SYS_USER a ,
			           ty_kdk_jh jh,
			           ty_product_type tpt
			           where zy = '批量自动扣本金' and 
			           tk.sfjq= '0.0' 
			           and tk.jjh =lsz.jjh 
			           and yehz.jjh=tk.jjh 
			           and base.khnm=tk.khh 
			           and base.id=b.ty_customer_id 
			           and a.id=b.user_id 
			           and jh.ywbh=tk.ywbh||'HT'
			           and tpt.product_code=tk.cpmc
			            and  to_date(tk.dqrq,'yy-mm-dd')>trunc(sysdate) 
			          <!--  and a.id ='8a855a3c5a5ff169015a60012091003a' -->
			           ) where cn=1
					<if test="certiCode != null and certiCode != '' ">
						AND CARD_ID=#{certiCode}
					</if>
					<if test="organName != null and organName != '' ">
					    AND  YWJG=#{organName}
					</if>
					
					<if test="custManagerName != null and custManagerName != '' ">
						AND KHJL=#{custManagerName}
					</if>
	</select>
	
	<!--信贷流程统计-->
	<select id="findXdlctjbbFormList" resultMap="XdlctjbbForms" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
                      select 
                      distinct bai.id,
                       bai.chinese_name,
			         bai.card_id,
			         p.PRODUCT_NAME,
			         cai.APPLY_QUOTA,
			         cai.CREATED_TIME,
			         t.start_examine_time ,
			        cai.jkrq,
			        trunc(trunc(to_timestamp(cai.jkrq, 'yyyy-mm-dd hh24:mi:ss.ff'))- cai.created_time) as xdsj,
			         su.display_name,
			         (select t.name from sys_department t where t.id in 
			             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname
			               <!--  from wf_status_queue_record t 
			             left join wf_status_info s on t.current_status = s.id 
			             left join wf_process_record pr on t.current_process = pr.id 
			             left join customer_application_process aa on pr.id = aa.serial_number
			              left join sys_user su on t.examine_user = su.id 
			              left join customer_application_info cai on cai.id=aa.application_id
			              left join basic_customer_information bai on cai.customer_id=bai.id
			              left join ty_customer_base base on bai.ty_customer_id=base.id
			              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id -->
			              from customer_application_info cai  
				  	  left join customer_application_process aa on cai.id=aa.application_id
			          left join basic_customer_information bai on cai.customer_id=bai.id
		              left join sys_user su on su.id=bai.user_id
		              left join ty_customer_base base on bai.ty_customer_id=base.id
		              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
		              left join  wf_process_record pr on pr.id = aa.serial_number
		              left join wf_status_queue_record t on t.current_process = pr.id 
		              left join wf_status_info s on t.current_status = s.id 
					<if test="certiCode != null and certiCode != '' ">
						AND cardId=#{certiCode}
					</if>
					<if test="customerName != null and customerName != '' ">
					    AND chineseName=#{customerName}
					</if>
					<if test="organName != null and organName != '' ">
					    AND a.name=#{organName}
					</if>
					<if test="custManagerName != null and custManagerName != '' ">
						AND a.custManager=#{custManagerName}
					</if>
					order by  cai.CREATED_TIME
		 			<![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findXdlctjbbFormCountList" resultType="int" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
		 select count(*)   from (   select  distinct bai.id, bai.chinese_name,
			         bai.card_id,
			         p.PRODUCT_NAME,
			         cai.APPLY_QUOTA,
			         cai.CREATED_TIME,
			         t.start_examine_time ,
			        cai.jkrq,
			        trunc(trunc(to_timestamp(cai.jkrq, 'yyyy-mm-dd hh24:mi:ss.ff'))- cai.created_time) as xdsj,
			         su.display_name,
			         (select t.name from sys_department t where t.id in 
			             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname
			                from wf_status_queue_record t 
			             left join wf_status_info s on t.current_status = s.id 
			             left join wf_process_record pr on t.current_process = pr.id 
			             left join customer_application_process aa on pr.id = aa.serial_number
			              left join sys_user su on t.examine_user = su.id 
			              left join customer_application_info cai on cai.id=aa.application_id
			              left join basic_customer_information bai on cai.customer_id=bai.id
			              left join ty_customer_base base on bai.ty_customer_id=base.id
			              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
						<if test="certiCode != null and certiCode != '' ">
							AND cardId=#{certiCode}
						</if>
						<if test="customerName != null and customerName != '' ">
						    AND chineseName=#{customerName}
						</if>
						<if test="organName != null and organName != '' ">
						    AND a.name=#{organName}
						</if>
						<if test="custManagerName != null and custManagerName != '' ">
							AND a.custManager=#{custManagerName}
						</if>)
	</select>
	
	<select id="getXdlctjbbFormList" resultMap="XdlctjbbFormResultMap" 
			parameterType="com.cardpay.pccredit.report.filter.ReportFilter">
					 select a.*,ROWNUM row_index from xdlctjbb a WHERE 1=1 
					<if test="certiCode != null and certiCode != '' ">
						AND a.cardId=#{certiCode}
					</if>
					<if test="customerName != null and customerName != '' ">
					    AND a.chineseName=#{customerName}
					</if>
					<if test="organName != null and organName != '' ">
					    AND a.name=#{organName}
					</if>
					<if test="custManagerName != null and custManagerName != '' ">
						AND a.custManager=#{custManagerName}
					</if>
	</select>
	
	 
	 
	 <select id="getAccLoanCollect" resultMap="CollectResultMap"
			parameterType="com.cardpay.pccredit.report.filter.AccLoanCollectFilter">
		<!-- 	 select rownum rowIndex,
        '' as increaseLoancount,
        '' as loanCustomerSum,
        '' as increaseCusSum,
        '' as centreLoansSun,
        '' as loanBalanceSum,
        '' as increaseLoanCredit,
        '' as increaseBalanceTheMonth,
        '' as overdueBalanceTheMon,
        '' as overdueBalance,
        '' as increseOverdueCusTheMon,
        '' as resvIntAccum,
        '' as overdueCusM0,
        '' as overdueCusM1,
        '' as overdueCusM2,
        '' as overdueCusM3,
        '' as overdueCusM4,
        '' as contAmt,
        '' as contBalace,
        '' as alloverdue
   from dual  -->
	      with mibusidata as (
	     SELECT *
		  FROM (
                 <!--     select
        distinct
          tkmx.YWBH ,
          b.id as id ,
          b.KHH,
          b.KHMC,
          b.ZJHM,
          rygl.SSBM,
          b.SJ,
          b.SXED,
          b.GHJL,
          tkmx.JKRQ as LOANDATE, 
          tkmx.DQRQ,
          tkmx.DKQX,
          tkmx.JZLL,
          tkmx.FFJE   as REQLMT,  
         jh.ts as DELAYINTERESTDAYS, 
           jh.ts as DELAYAMTDAYS,   
           jh.qs as qs,    
            rq.a+jh.ts as DLAYDT, 
          yehz.SHBJ,
          yehz.JKJE,
          yehz.KSQXRQ,
          yehz.SHLX,   
          yehz.DKYE,
          yehz.BNQX,
          yehz.BWQX,
          yehz.DKYE as BALAMT  ,
          yehz.jkje-yehz.dkye as yxye ,
          sysuser.display_name
        from
         (select trunc(to_date(rq,'yyyy-mm-dd')) a from ty_kdk_jh) rq,
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      ty_customer_rygl rygl,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      basic_customer_information basic,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      b.khjl=rygl.dm and
                      yehz.JJH = tkmx.JJH and
                              substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
                              b.id=basic.ty_customer_id and
                              basic.user_id=sysuser.id and
                               rq.a=to_date(jh.rq,'yyyy-mm-dd') 
                               <if test="userId != null and userId != '' ">
						             and sysuser.id  =#{userId}
						         </if>
                               -->
          select
        distinct
          tkmx.YWBH ,
          b.id as id ,
          b.KHH,
          b.KHMC,
          b.ZJHM,
          rygl.SSBM,
          b.SJ,
          b.SXED,
          b.GHJL,
          tkmx.JKRQ as LOANDATE, 
          tkmx.DQRQ,
          tkmx.DKQX,
          tkmx.JZLL,
          tkmx.FFJE   as REQLMT,
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS, 
           max(lsz.jzrq) as DLAYDT,
          yehz.SHBJ,
          yehz.JKJE,
          yehz.KSQXRQ,
          yehz.SHLX as PAYDEBT,  
          yehz.DKYE,
          yehz.BNQX,
          yehz.BWQX,
          yehz.DKYE as BALAMT  ,
          yehz.dkye as yxye,
          sysuser.id userid,
          sysuser.display_name
       from
              ty_repay_tkmx tkmx,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
             ty_kdk_jh jh,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              b.khnm=tkmx.khh and
              jh.ywbh=tkmx.ywbh||'HT' and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh
             <if test="userId != null and userId != '' ">
			             and sysuser.id  =#{userId}
			         </if>
              group by tkmx.YWBH ,b.id ,b.KHH,b.KHMC, b.ZJHM,rygl.SSBM, b.SJ, b.SXED, b.GHJL,tkmx.JKRQ , tkmx.DQRQ, tkmx.DKQX,tkmx.JZLL, tkmx.FFJE  ,
                 yehz.SHBJ,yehz.JKJE, yehz.KSQXRQ,yehz.SHLX, yehz.DKYE,yehz.BNQX, yehz.BWQX,yehz.DKYE  , yehz.dkye  , sysuser.display_name, sysuser.id 
              order by tkmx.jkrq
	    ))
  <!--  select count(distinct(a.id))
          from mibusidata a, basic_customer_information b
         where a.id = b.ty_customer_id -->
   select ( select count(distinct(YWBH))
          from mibusidata 
          where 1=1
         and LOANDATE <![CDATA[ <=  ]]> to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
         and LOANDATE <![CDATA[ >=  ]]> to_char( to_date( #{startDate} ,'yyyy/mm/dd'),'yyyymmdd')
         <if test="userId != null and userId != '' ">
               and userid =#{userId}
         </if> ) as increaseLoancount
            ,
           <!--  select count(distinct(a.id))
          from mibusidata a, basic_customer_information b
         where a.id = b.ty_customer_id -->
       ( select count(distinct(a.YWBH))
          from mibusidata a
          where 1=1
         and a.LOANDATE <![CDATA[ <=  ]]> to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
         <if test="userId != null and userId != '' ">
               and a.userid =#{userId}
         </if>  ) as loanCustomerSum 
          ,
         
         <!-- select count(distinct(b.id))
          from mibusidata a,
               basic_customer_information b
         where b.ty_customer_id=a.id -->
       (select count(distinct(a.YWBH))
          from mibusidata a
          where 1=1
         and a.LOANDATE <![CDATA[ <=  ]]> to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
         and a.LOANDATE <![CDATA[ >=  ]]> to_char( to_date( #{startDate} ,'yyyy/mm/dd'),'yyyymmdd')
         <if test="userId != null and userId != '' ">
               and a.userid =#{userId}
         </if> ) as increaseCusSum
          ,
           
         <!--  select count(distinct(b.id))
          from mibusidata a,
               basic_customer_information b 
         where b.ty_customer_id=a.id -->
       (select count(distinct(a.YWBH))
          from mibusidata a
          where 1=1
         and a.LOANDATE <![CDATA[ <=  ]]> to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
         <if test="userId != null and userId != '' ">
               and a.userid =#{userId}
         </if> ) as centreLoansSun
       		   ,
          <!--  select count(distinct a.id)
          from mibusidata a, basic_customer_information b
         where a.id = b.ty_customer_id -->
       (select count(distinct a.YWBH)
          from mibusidata a
         where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >  ]]> 0 or nvl(a.DELAYAMTDAYS,0) <![CDATA[ >  ]]> 0)
           and a.DLAYDT <![CDATA[ <=  ]]>  to_char(to_date( #{endDate}  ,'yyyy/mm/dd'))
           and a.DLAYDT <![CDATA[ >=  ]]>  to_char(to_date( #{startDate}  ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as increseOverdueCusTheMon  
            ,
           
       (select count(distinct a.YWBH)
          from mibusidata a
         where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >  ]]> 0 or nvl(a.DELAYAMTDAYS,0) <![CDATA[ >  ]]> 0)
           and a.DLAYDT <![CDATA[ <=  ]]>  to_char(to_date( #{endDate}  ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as alloverdue
           ,
           
       (select  sum(a.balamt)/(trunc(to_date(#{endDate},'yyyy-MM-dd'))-trunc(to_date(#{startDate},'yyyy-MM-dd')))
             from mibusidata a
          where 1=1
           and a.LOANDATE <![CDATA[ <=  ]]>to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
           and a.LOANDATE <![CDATA[ >=  ]]> to_char( to_date( #{startDate} ,'yyyy/mm/dd'),'yyyymmdd')
           <if test="userId != null and userId != '' ">
             and a.userid =#{userId}
           </if> ) as increaseBalanceTheMonth
          ,
           
       (select sum(a.yxye)
          from mibusidata a
          where 1=1
           and a.LOANDATE <![CDATA[ <=  ]]> to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
           and a.LOANDATE <![CDATA[ >=  ]]> to_char( to_date( #{startDate} ,'yyyy/mm/dd'),'yyyymmdd')
           <if test="userId != null and userId != '' ">
            and a.userid =#{userId}
           </if> ) as loanBalanceSum
       ,
           
       (select sum(a.yxye)
          from mibusidata a
          where 1=1
           and a.LOANDATE <![CDATA[ <=  ]]> to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
           <if test="userId != null and userId != '' ">
             and a.userid =#{userId}
           </if> ) as contBalace
          ,
           
      ( select sum(a.yxye)
        from mibusidata a
          where 1=1
           and a.LOANDATE <![CDATA[ <=  ]]>  to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
           and a.LOANDATE <![CDATA[ >=  ]]> to_char( to_date( #{startDate}  ,'yyyy/mm/dd'),'yyyymmdd')
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as increaseLoanCredit
         ,
           
       ( select sum(a.REQLMT)
        from mibusidata a
          where 1=1
           and a.LOANDATE <![CDATA[ <=  ]]>  to_char( to_date( #{endDate} ,'yyyy/mm/dd'),'yyyymmdd')
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as contAmt 
              ,
       (select sum(nvl(a.DKYE,0) + nvl(a.BNQX,0) + nvl(a.BWQX,0)) 
          from mibusidata a
           where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0)  >   0 or nvl(a.DELAYAMTDAYS,0)  >  0)
           and a.DLAYDT <![CDATA[ <=  ]]> to_char(to_date( #{endDate} ,'yyyy/mm/dd'))
           and a.DLAYDT <![CDATA[ >=  ]]> to_char(to_date( #{startDate},'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
             and a.userid =#{userId}
           </if> ) as overdueBalanceTheMon
         ,
           
       (select sum(nvl(a.DKYE,0) + nvl(a.BNQX,0) + nvl(a.BWQX,0)) 
          from mibusidata a
           where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0)  >   0 or nvl(a.DELAYAMTDAYS,0)  >  0)
           and a.DLAYDT <![CDATA[ <=  ]]> to_char(to_date( #{endDate} ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
             and a.userid =#{userId}
           </if>) as overdueBalance
             ,
           
       (select count(distinct a.YWBH)
          from mibusidata a
          where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >  ]]> 0 or nvl(a.DELAYAMTDAYS,0) <![CDATA[ >  ]]> 0)
           and nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ <  ]]> 30
           and nvl(a.DELAYAMTDAYS,0) <![CDATA[ < ]]> 30
           and a.DLAYDT <![CDATA[ <=  ]]>to_char(to_date( #{endDate} ,'yyyy/mm/dd'))
           and a.DLAYDT <![CDATA[ >=  ]]> to_char(to_date(  #{startDate} ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as overdueCusM0
           ,
           
       (  select count(distinct a.YWBH)
          from mibusidata a
          where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >  ]]> 0 or nvl(a.DELAYAMTDAYS,0) <![CDATA[ >  ]]> 0)
           and nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >=  ]]> 30
           and nvl(a.DELAYAMTDAYS,0) <![CDATA[ >=  ]]> 30
           and a.DLAYDT <![CDATA[ <=  ]]>to_char(to_date( #{endDate} ,'yyyy/mm/dd'))
           and a.DLAYDT <![CDATA[ >=  ]]>to_char(to_date(  #{startDate} ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
           and a.userid =#{userId}
           </if> ) as overdueCusM1
            ,
           
       (select count(distinct a.YWBH)
          from mibusidata a
          where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >  ]]> 0 or nvl(a.DELAYAMTDAYS,0) <![CDATA[ >  ]]> 0)
           and nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >=  ]]> 60
           and nvl(a.DELAYAMTDAYS,0) <![CDATA[ >=  ]]> 60
           and a.DLAYDT <![CDATA[ <=  ]]>to_char(to_date( #{endDate} ,'yyyy/mm/dd'))
           and a.DLAYDT <![CDATA[ >=  ]]>to_char(to_date(  #{startDate} ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as overdueCusM2
           ,
           
       (   select count(distinct a.YWBH)
          from mibusidata a
          where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >  ]]> 0 or nvl(a.DELAYAMTDAYS,0) <![CDATA[ >  ]]> 0)
           and nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >=  ]]> 90
           and nvl(a.DELAYAMTDAYS,0) <![CDATA[ >=  ]]> 90
           and a.DLAYDT <![CDATA[ <=  ]]>to_char(to_date( #{endDate} ,'yyyy/mm/dd'))
           and a.DLAYDT <![CDATA[ >=  ]]>to_char(to_date(  #{startDate} ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as overdueCusM3
           ,
           
       (select count(distinct a.YWBH)
          from mibusidata a
          where 1=1
           and (nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >  ]]> 0 or nvl(a.DELAYAMTDAYS,0) <![CDATA[ >  ]]> 0)
           and nvl(a.DELAYINTERESTDAYS,0) <![CDATA[ >=  ]]> 120
           and nvl(a.DELAYAMTDAYS,0) <![CDATA[ >=  ]]> 120
           and a.DLAYDT <![CDATA[ <=  ]]>to_char(to_date( #{endDate} ,'yyyy/mm/dd'))
           and a.DLAYDT <![CDATA[ >=  ]]> to_char(to_date(  #{startDate} ,'yyyy/mm/dd'))
           <if test="userId != null and userId != '' ">
              and a.userid =#{userId}
           </if> ) as overdueCusM4
          <!--  ,
           
       ( select sum(a.SHLX)
          from mibusidata a, basic_customer_information b
         where a.id = b.ty_customer_id
         and a.LOANDATE <![CDATA[ <=  ]]> #{endDate}
         and a.LOANDATE <![CDATA[ >=  ]]> #{startDate}
         <if test="userId != null and userId != '' ">
             and b.USER_ID =#{userId}
         </if> ) as resvIntAccum  -->
        <!--  ,
         
        ( select nvl(sum(a.DKYE),0) from 
           mibusidata a,
           basic_customer_information b
         where a.id = b.ty_customer_id
               and a.MAINASSURE ='C100'
               and a.LOANDATE <![CDATA[ <=  ]]>to_date( #{endDate} ,'yyyy/mm/dd')
         	   and a.LOANDATE <![CDATA[ >=  ]]>  to_date(  #{startDate} ,'yyyy/mm/dd')
         <if test="userId != null and userId != '' ">
             and b.USER_ID =#{userId}
         </if>) as xy
        ,
         
         (select nvl(sum(a.DKYE),0) from 
           mibusidata a,
           basic_customer_information b
         where a.id = b.ty_customer_id
               and a.MAINASSURE ='C101'
               and a.LOANDATE <![CDATA[ <=  ]]>to_date( #{endDate} ,'yyyy/mm/dd')
         	   and a.LOANDATE <![CDATA[ >=  ]]>to_date(  #{startDate} ,'yyyy/mm/dd')
           <if test="userId != null and userId != '' ">
             and b.USER_ID =#{userId}
           </if>) as bz
            ,
         
         (select nvl(sum(a.DKYE),0) from 
           mibusidata a,
           basic_customer_information b
         where a.id = b.ty_customer_id
               and a.MAINASSURE ='C102'
               and a.LOANDATE <![CDATA[ <=  ]]> to_date( #{endDate} ,'yyyy/mm/dd')
         	   and a.LOANDATE <![CDATA[ >=  ]]> to_date(  #{startDate} ,'yyyy/mm/dd')
           <if test="userId != null and userId != '' ">
             and b.USER_ID =#{userId}
           </if>) as dy -->

  from dual
   

 	 </select>
</mapper>
