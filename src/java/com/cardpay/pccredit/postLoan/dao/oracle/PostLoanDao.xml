<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cardpay.pccredit.postLoan.dao.PostLoanDao">


	 <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.postLoan.model.Fcloaninfo" >
   			  <result column="KEYCODE" 		property="keycode" jdbcType="VARCHAR" /> 
			  <result column="YEAR" 		property="year" jdbcType="VARCHAR" /> 
			  <result column="TIMES"		property="times" jdbcType="VARCHAR" /> 
			  <result column="BUSICODE" 	property="busicode" jdbcType="VARCHAR" /> 
			  <result column="BUSITYPE" 	property="busitype" jdbcType="VARCHAR" /> 
			  <result column="DEPTCODE" 	property="deptcode" jdbcType="VARCHAR" /> 
			  <result column="INSTCITYCODE" property="instcitycode" jdbcType="VARCHAR" /> 
			  <result column="CONTRACTCODE" property="contractcode" jdbcType="VARCHAR" /> 
			  <result column="CUSTID" 		property="custid" jdbcType="VARCHAR" /> 
			  <result column="CNAME" 		property="cname" jdbcType="VARCHAR" /> 
			  <result column="TYPEID" 		property="typeid" jdbcType="VARCHAR" /> 
			  <result column="CUSTTYPE" 	property="custtype" jdbcType="VARCHAR" /> 
			  <result column="CUSTPROPERTY" property="custproperty" jdbcType="VARCHAR" /> 
			  <result column="ORGCERTCODE" 	property="orgcertcode" jdbcType="VARCHAR" /> 
			  <result column="UNITCUSTTYPE" property="unitcusttype" jdbcType="VARCHAR" /> 
			  <result column="CARDTYPE" 	property="cardtype" jdbcType="VARCHAR" /> 
			  <result column="CARDNUM" 		property="cardnum" jdbcType="VARCHAR" /> 
			  <result column="CITY" 		property="city" jdbcType="VARCHAR" /> 
			  <result column="DISTRICTCOUNTY" property="districtcounty" jdbcType="VARCHAR" /> 
			  <result column="TOWN"			  property="town" jdbcType="VARCHAR" /> 
			  <result column="COMMUNITY" 	  property="community" jdbcType="VARCHAR" /> 
			  <result column="INSTCODE" 	  property="instcode" jdbcType="VARCHAR" /> 
			  <result column="CURRENCY" 	  property="currency" jdbcType="VARCHAR" /> 
			  <result column="MONEY" 		  property="money" jdbcType="VARCHAR" /> 
			  <result column="BALAMT" 		  property="balamt" jdbcType="VARCHAR" /> 
			  <result column="DEBTINTEREST"   property="debtinterest" jdbcType="VARCHAR" /> 
			  <result column="REQLMT" 		  property="reqlmt" jdbcType="VARCHAR" /> 
			  <result column="LOANDATE" 	  property="loandate" jdbcType="VARCHAR" /> 
			  <result column="ENDDATE" 		  property="enddate" jdbcType="VARCHAR" /> 
			  <result column="BUSISTATE"      property="busistate" jdbcType="VARCHAR" /> 
			  <result column="CREDITLEVEL"    property="creditlevel" jdbcType="VARCHAR" /> 
			  <result column="INDUSTRY"       property="industry" jdbcType="VARCHAR" /> 
			  <result column="LOANPURPOSE"    property="loanpurpose" jdbcType="VARCHAR" /> 
			  <result column="MAINASSURE"     property="mainassure" jdbcType="VARCHAR" /> 
			  <result column="BUSIMANAGER"    property="busimanager" jdbcType="VARCHAR" /> 
			  <result column="ISBACK" 		  property="isback" jdbcType="VARCHAR" /> 
			  <result column="ISBIGCOMPANY"   property="isbigcompany" jdbcType="VARCHAR" /> 
			  <result column="STATE" 		  property="state" jdbcType="VARCHAR" /> 
			  <result column="ISLOWRISK" 	  property="islowrisk" jdbcType="VARCHAR" /> 
			  <result column="VALIDTIME" 	  property="validtime" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULT"     property="sortresult" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULTFIVE" property="sortresultfive" jdbcType="VARCHAR" /> 
			  <result column="PRESORTRESULT"  property="presortresult" jdbcType="VARCHAR" /> 
			  <result column="PRESORTFIVE"    property="presortfive" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTRESULT" property="autosortresult" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTREMARK" property="autosortremark" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTFIVE"   property="autosortfive" jdbcType="VARCHAR" /> 
			  <result column="ISADM" 		  property="isadm" jdbcType="VARCHAR" /> 
			  <result column="CUSTSCALE"      property="custscale" jdbcType="VARCHAR" /> 
			  <result column="OVERTIMES"      property="overtimes" jdbcType="VARCHAR" /> 
			  <result column="DELAYAMTDAYS"   property="delayamtdays" jdbcType="VARCHAR" /> 
			  <result column="DELAYINTERESTDAYS" property="delayinterestdays" jdbcType="VARCHAR" /> 
			  <result column="CHANGEFLAG" 		 property="changeflag" jdbcType="VARCHAR" /> 
			  <result column="CATEGORYTYPE" 	 property="categorytype" jdbcType="VARCHAR" /> 
			  <result column="OPERDATETIME"      property="operdatetime" jdbcType="VARCHAR" /> 
			  <result column="OPERATOR" 		 property="operator" jdbcType="VARCHAR" /> 
			  <result column="ISWORKMANU" 		 property="isworkmanu" jdbcType="VARCHAR" /> 
			  <result column="ADMDATE" 			 property="admdate" jdbcType="VARCHAR" /> 
			  <result column="AJUSTSTATE" 		 property="ajuststate" jdbcType="VARCHAR" /> 
			  <result column="ISTRANS" 			 property="istrans" jdbcType="VARCHAR" /> 
			  <result column="LASTYEARSORTRESULT" property="lastyearsortresult" jdbcType="VARCHAR" /> 
			  <result column="PROCESSID" 		  property="processid" jdbcType="VARCHAR" /> 
			  <result column="TOBADLOANREASON"    property="tobadloanreason" jdbcType="VARCHAR" /> 
			  <result column="BADLOANDATE" 		  property="badloandate" jdbcType="VARCHAR" /> 
			  <result column="CREATE_TIME" 		  property="create_time" jdbcType="VARCHAR" /> 
 	 </resultMap>
 	  <resultMap id="lszform" type="com.cardpay.pccredit.postLoan.model.TyRarepaylistForm" >
 	      	<result column="ywbh" 		property="ywbh" 			jdbcType="VARCHAR" />
 	      	<result column="khmc" 		property="khmc" 			jdbcType="VARCHAR" />
 	      	<result column="jkrq" 		property="jkrq" 			jdbcType="VARCHAR" />
 	      	<result column="bj" 		property="bj" 			jdbcType="VARCHAR" />
 	      	<result column="lx" 		property="lx" 			jdbcType="VARCHAR" />
 	      	<result column="jxfs" 		property="jxfs" 			jdbcType="VARCHAR" />
 	      	<result column="jzrq" 		property="jzrq" 			jdbcType="VARCHAR" />
 	      	<result column="display_name" 		property="display_name" 			jdbcType="VARCHAR" />
 	      	<result column="create_time" 		property="create_time" 			jdbcType="VARCHAR" />
 	 </resultMap>
 	 <resultMap id="BaseResultMap2" type="com.cardpay.pccredit.postLoan.model.RarepaylistForm" >
   		<result column="KEYCODE" 		property="keycode" 			jdbcType="VARCHAR" />
		<result column="REPAYDATE" 		property="repaydate" 		jdbcType="VARCHAR" />
		<result column="BUSICODE" 		property="busicode" 		jdbcType="VARCHAR" />
		<result column="REPAYAMT" 		property="repayamt" 		jdbcType="VARCHAR" />
		<result column="RAPAYINTEREST"	property="rapayinterest" 	jdbcType="VARCHAR" />
		<result column="SQUAREMODEL" 	property="squaremodel" 		jdbcType="VARCHAR" />
		<result column="SQUAREOPER" 	property="squareoper" 		jdbcType="VARCHAR" />
		<result column="HANDLESCHEMAID" property="handleschemaid" 	jdbcType="VARCHAR" />
		<result column="HANDLETYPEID" 	property="handletypeid"     jdbcType="VARCHAR" />
		<result column="INSTCODE" 		property="instcode" 		jdbcType="VARCHAR" />
		<result column="DEPTCODE" 		property="deptcode" 		jdbcType="VARCHAR" />
		<result column="INSTCITYCODE" 	property="instcitycode" 	jdbcType="VARCHAR" />
		<result column="OPERDATETIME" 	property="operdatetime" 	jdbcType="VARCHAR" />
		<result column="OPERATOR_1" 	property="operator_1" 		jdbcType="VARCHAR" />
		<result column="LOANSTATUS"	    property="loanstatus" 		jdbcType="VARCHAR" />
		<result column="ISTRANS" 		property="istrans" 			jdbcType="VARCHAR" />
		<result column="CREATE_TIME" 	property="create_time" 		jdbcType="VARCHAR" />
		<result column="PARAM1" 	    property="param1" 			jdbcType="VARCHAR" />
 	 </resultMap>
 	 <resultMap id="MibusidateView" type="com.cardpay.pccredit.postLoan.model.MibusidateView" >
	<result column="YWBH" property="YWBH" jdbcType="VARCHAR" />
	<result column="id" property="id" jdbcType="VARCHAR" />
	<result column="KHH" property="KHH" jdbcType="VARCHAR" />
	<result column="KHMC" property="KHMC" jdbcType="VARCHAR" />
	<result column="ZJHM" property="ZJHM" jdbcType="VARCHAR" />
	<result column="SSBM" property="SSBM" jdbcType="VARCHAR" />
	<result column="SJ" property="SJ" jdbcType="VARCHAR" />
	<result column="SXED" property="SXED" jdbcType="VARCHAR" />
	<result column="GHJL" property="GHJL" jdbcType="VARCHAR" />
	<result column="LOANDATE" property="LOANDATE" jdbcType="VARCHAR" />
	<result column="DQRQ" property="DQRQ" jdbcType="VARCHAR" />
	<result column="DKQX" property="DKQX" jdbcType="VARCHAR" />
	<result column="JZLL" property="JZLL" jdbcType="VARCHAR" />
	<result column="REQLMT" property="REQLMT" jdbcType="VARCHAR" />
	<result column="DELAYINTERESTDAYS" property="DELAYINTERESTDAYS" jdbcType="VARCHAR" />
	<result column="DELAYAMTDAYS" property="DELAYAMTDAYS" jdbcType="VARCHAR" />
	<result column="qs" property="qs" jdbcType="VARCHAR" />
	<result column="DLAYDT" property="DLAYDT" jdbcType="VARCHAR" />
	<result column="DF" property="DF" jdbcType="VARCHAR" />
	<result column="YE" property="YE" jdbcType="VARCHAR" />
	<result column="SHBJ" property="SHBJ" jdbcType="VARCHAR" />
	<result column="JKJE" property="JKJE" jdbcType="VARCHAR" />
	<result column="KSQXRQ" property="KSQXRQ" jdbcType="VARCHAR" />
	<result column="SHLX" property="SHLX" jdbcType="VARCHAR" />
	<result column="DKYE" property="DKYE" jdbcType="VARCHAR" />
	<result column="BNQX" property="BNQX" jdbcType="VARCHAR" />
	<result column="BWQX" property="BWQX" jdbcType="VARCHAR" />
	<result column="BALAMT" property="BALAMT" jdbcType="VARCHAR" />
	<result column="yxye" property="yxye" jdbcType="VARCHAR" /> 
	<result column="HKFS" property="HKFS" jdbcType="VARCHAR" />  
	<result column="je" property="je" jdbcType="VARCHAR" />  
	<result column="CREATE_TIME" property="CREATE_TIME" jdbcType="VARCHAR" /> 
	<result column="dlayamtsum" property="dlayamtsum" jdbcType="VARCHAR" /> 
 	 </resultMap>
 	 
 	 <resultMap id="BaseResultMap3" type="com.cardpay.pccredit.postLoan.model.MibusidataForm" >
   		 <result column="BUSICODE"        property="busicode"    jdbcType="VARCHAR" />         
		 <result column="CUSTID"        property="custid"    jdbcType="VARCHAR" />         
		 <result column="CNAME"        property="cname"    jdbcType="VARCHAR" />         
		 <result column="DEPTCODE"        property="deptcode"    jdbcType="VARCHAR" />         
		 <result column="MAINASSURE"        property="mainassure"    jdbcType="VARCHAR" />         
		 <result column="REQLMT"        property="reqlmt"    jdbcType="VARCHAR" />         
		 <result column="LOANDATE"        property="loandate"    jdbcType="VARCHAR" />         
		 <result column="STARTDATE"        property="startdate"    jdbcType="VARCHAR" />         
		 <result column="ORIENDDATE"        property="orienddate"    jdbcType="VARCHAR" />         
		 <result column="ENDDATE"        property="enddate"    jdbcType="VARCHAR" />         
		 <result column="MONEY"        property="money"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="STATE"        property="accountstate"    jdbcType="VARCHAR" />         
		 <result column="CLOSEDATE"        property="closedate"    jdbcType="VARCHAR" />         
		 <result column="FIVECLASS"        property="fiveclass"    jdbcType="VARCHAR" />         
		 <result column="DELAYAMTDAYS"        property="delayamtdays"    jdbcType="VARCHAR" />         
		 <result column="DELAYINTERESTDAYS"        property="delayinterestdays"    jdbcType="VARCHAR" />         
		 <result column="FIRSTINTERESTDATE"        property="firstinterestdate"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTEREST"        property="debtinterest"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTERESTTIMES"        property="debtinteresttimes"    jdbcType="VARCHAR" />         
		 <result column="DLAYAMT"        property="dlayamt"    jdbcType="VARCHAR" />         
		 <result column="DLAYDT"        property="dlaydt"    jdbcType="VARCHAR" />         
		 <result column="PAYDEBT"        property="paydebt"    jdbcType="VARCHAR" />         
		 <result column="INDEBTAMT"        property="indebtamt"    jdbcType="VARCHAR" />         
		 <result column="OUTDEBTAMT"        property="outdebtamt"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="CREATE_TIME"        property="create_time"    jdbcType="VARCHAR" />    
		 <result column="CUSTIDNO"        property="custidno"    jdbcType="VARCHAR" />  
		 <result column="LIMIT"        property="limit"    jdbcType="VARCHAR" />  
		 <result column="REPAYMETHOD"        property="repaymethod"    jdbcType="VARCHAR" />  
		 <result column="SPMC"        property="SPMC"    jdbcType="VARCHAR" />  
		 <result column="JF"        property="jf"    jdbcType="VARCHAR" />  
		 <result column="AUDIT_TIME"        property="audittime"    jdbcType="DATE" />  
		 <result column="REFUSAL_REASON"        property="refusalreason"    jdbcType="VARCHAR" /> 
		 <result column="DISPLAY_NAME"        property="displayname"    jdbcType="VARCHAR" />  
 	 </resultMap>
 	  <resultMap id="refusemibusidata" type="com.cardpay.pccredit.postLoan.model.RefuseMibusidata" >
 	      <result column="ywbh"        property="ywbh"    jdbcType="VARCHAR" /> 
   		<result column="CHINESE_NAME"        property="CHINESE_NAME"    jdbcType="VARCHAR" />  
   		<result column="CARD_ID"        property="CARD_ID"    jdbcType="VARCHAR" /> 
   		<result column="TELEPHONE"        property="TELEPHONE"    jdbcType="VARCHAR" /> 
   		<result column="industry"        property="industry"    jdbcType="VARCHAR" />
   		<result column="spmc"        property="spmc"    jdbcType="VARCHAR" /> 
   		<result column="RESIDENTIAL_ADDRESS"        property="RESIDENTIAL_ADDRESS"    jdbcType="VARCHAR" /> 
   		<result column="JKJE"        property="JKJE"    jdbcType="VARCHAR" /> 
   		<result column="JKRQ"        property="JKRQ"    jdbcType="VARCHAR" /> 
   		<result column="AUDIT_TIME"        property="AUDIT_TIME"    jdbcType="VARCHAR" /> 
   		<result column="REFUSAL_REASON"        property="REFUSAL_REASON"    jdbcType="VARCHAR" /> 
   		<result column="DISPLAY_NAME"        property="DISPLAY_NAME"    jdbcType="VARCHAR" /> 
   		<result column="PROCESS_OP_STATUS"        property="PROCESS_OP_STATUS"    jdbcType="VARCHAR" /> 
 	 </resultMap>

	  <resultMap id="BaseResultMap" type="com.cardpay.pccredit.customer.model.TyRepayTkmxForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	  </resultMap>
 	  <resultMap id="CreditProcess" type="com.cardpay.pccredit.postLoan.model.CreditProcess" >
   		<result column="spmc" 		property="spmc"  />
		<result column="chinese_name" 	property="customername" />
		<result column="teamname" 	property="teamname" />
		<result column="bljg" 		property="bljg" />
		<result column="dklx" 		property="dklx" />
		<result column="assure_means"	property="mainassure"/>
		<result column="hyfl" 	property="industry" />
		<result column="display_name" 	property="mananger"/>
		<result column="created_time" property="applytime"/>
		<result column="apply_quota" 	property="applymoney"/>
		<result column="start_examine_time" 		property="willtime" />
		<result column="examine_result" 	property="auditopinion" />
		<result column="examine_amount" 	property="examineamount" />
		<result column="jkrq" 	property="audittime" />
		<result column="zjts" 	property="zjdays" />
		<result column="examine_lv"	    property="examine" 	 />
		<result column="status" 		property="status" />
		<result column="id" 		property="id" />
		<result column="CARD_ID" 		property="cardId" />
		<result column="carId" 		property="zjmh" />
		
		
 	 </resultMap>
 	 <!-- <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.customer.model.TyRepayLshForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	 </resultMap>
 	
 	
	 	<select id="findListByFilter" resultMap="BaseResultMap" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.product_name as productName,c.zjhm from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
		</select>
		
	<select id="findListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*) from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl
	</select> 
	
	
	<select id="findLshListByFilter" resultMap="BaseResultMap1" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.khjl as khjl1  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
					  order by a.jjh,b.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findLshListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
	</select>  -->
	
	<!-- BaseResultMap1 -->
	<select id="findJJJnListByFilter" resultMap="BaseResultMap" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				 select distinct tkmx.ywbh as ywbh,
			        base.khmc as cname,
			        base.zjhm as zjhm,
			        tkmx.jkrq,
			        tkmx.ffje as ffje,
			        yehz.DKYE as balamt,
			        yehz.bnqx+yehz.bwqx as debtinterest,
			        tkmx.ffje as reqlmt,
			        jh.ts as delayamtdays,  
			        jh.ts as delayinterestdays
			          from
           (select  tkmx.ywbh as ywbh,
                      max(to_number(jh.qs)) as qs
          from
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      ty_customer_rygl rygl,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      yehz.JJH = tkmx.JJH and
                      jh.ywbh=tkmx.ywbh||'HT' and
                      b.khjl=rygl.dm and
                      rygl.ddrq=sysuser.external_id
                   group by tkmx.ywbh)  maxqs,
                    ty_customer_rygl rygl,
                    ty_customer_base base,
                     ty_product_type protype,
                    ty_repay_tkmx tkmx,
                    SYS_USER sysuser  ,
                    ty_repay_yehz yehz,
                    ty_kdk_jh jh,
                    ty_repay_lsz lsz
                    WHERE 
                    base.khjl=rygl.dm
                    and rygl.ddrq=sysuser.external_id
                    and base.khnm=tkmx.khh
                    and tkmx.JJH=yehz.JJH
                    and protype.product_code=tkmx.cpmc
                    and jh.ywbh=tkmx.ywbh||'HT' 
                    and lsz.jjh=tkmx.jjh
                    and maxqs.ywbh=tkmx.ywbh
                    and maxqs.qs=jh.qs
                     <if test="userId != null and userId != '' and userId!='000001'">
						AND sysuser.id=#{userId}
					   </if>
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(tkmx.ywbh)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(base.zjhm)=#{cardNum}
					  </if>
					  order  by tkmx.jkrq
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findJJJnListByFilters" resultMap="BaseResultMap" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
			 select distinct tkmx.ywbh as ywbh,
              base.khh as khh,
              base.khmc as cname,
              base.Khlx as khlx,
              base.Zjlx as zjlx,
              base.zjhm as zjhm,
              tkmx.jkrq,
              tkmx.ffje as ffje,
              yehz.DKYE as balamt,
              tkmx.jkrq as jkrq,
              tkmx.dqrq as dqrq,
              yehz.bnqx+yehz.bwqx as debtinterest,
              tkmx.ffje as reqlmt,
              jh.ts as delayamtdays,  
              jh.ts as delayinterestdays
                from
           (select  tkmx.ywbh as ywbh,
                      max(to_number(jh.qs)) as qs
          from
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      ty_customer_rygl rygl,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      yehz.JJH = tkmx.JJH and
                      jh.ywbh=tkmx.ywbh||'HT' and
                      b.khjl=rygl.dm and
                      rygl.ddrq=sysuser.external_id
                   group by tkmx.ywbh)  maxqs,
                   
                    ty_customer_rygl rygl,
                    ty_customer_base base,
                     ty_product_type protype,
                    ty_repay_tkmx tkmx,
                    SYS_USER sysuser  ,
                    ty_repay_yehz yehz,
                    ty_kdk_jh jh,
                    ty_repay_lsz lsz
                    WHERE 
                    base.khjl=rygl.dm
                    and rygl.ddrq=sysuser.external_id
                    and base.khnm=tkmx.khh
                    and tkmx.JJH=yehz.JJH
                    and protype.product_code=tkmx.cpmc
                    and jh.ywbh=tkmx.ywbh||'HT' 
                    and lsz.jjh=tkmx.jjh
                    and maxqs.ywbh=tkmx.ywbh
                    and maxqs.qs=jh.qs
                     <if test="userId != null and userId != '' and userId!='000001'">
						AND sysuser.id=#{userId}
					   </if>
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(tkmx.ywbh)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(base.zjhm)=#{cardNum}
					  </if>
                    order  by tkmx.jkrq
	</select>
	
	<select id="findJJJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(distinct tkmx.ywbh)    from
           (select  tkmx.ywbh as ywbh,
                      max(to_number(jh.qs)) as qs
          from
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      ty_customer_rygl rygl,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      yehz.JJH = tkmx.JJH and
                      jh.ywbh=tkmx.ywbh||'HT' and
                      b.khjl=rygl.dm and
                      rygl.ddrq=sysuser.external_id
                   group by tkmx.ywbh)  maxqs,
                    ty_customer_rygl rygl,
                    ty_customer_base base,
                     ty_product_type protype,
                    ty_repay_tkmx tkmx,
                    SYS_USER sysuser  ,
                    ty_repay_yehz yehz,
                    ty_kdk_jh jh,
                    ty_repay_lsz lsz
                    WHERE 
                    base.khjl=rygl.dm
                    and rygl.ddrq=sysuser.external_id
                    and base.khnm=tkmx.khh
                    and tkmx.JJH=yehz.JJH
                    and protype.product_code=tkmx.cpmc
                    and jh.ywbh=tkmx.ywbh||'HT' 
                    and lsz.jjh=tkmx.jjh
                    and maxqs.ywbh=tkmx.ywbh
                    and maxqs.qs=jh.qs
                   <if test="userId != null and userId != '' and userId!='000001'">
						AND sysuser.id=#{userId}
					   </if>
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(tkmx.ywbh)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(base.zjhm)=#{cardNum}
					  </if>
	    order  by tkmx.jkrq
	</select>
	
	
	
	<select id="findLshJnListByFilter" resultMap="lszform" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					 select
       distinct 
       tkmx.ywbh,
       b.khmc,
       tkmx.jkrq,
       shbj.df as bj,
       shlx.df as lx,
       tkmx.jxfs,
       shbj.jzrq,
       yehz.create_time
       from
        (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
      (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm,
                       max(lsz.jzrq) as jzrq
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
              ty_repay_tkmx tkmx,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
             ty_kdk_jh jh,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              b.khnm=tkmx.khh and
              jh.ywbh=tkmx.ywbh||'HT' and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              
               shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=b.zjhm and
             shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=b.Zjhm
               <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if>
			<!--  <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if> -->
                 order by tkmx.jkrq
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="selectRarepaylistfoInfoByBusicode" resultMap="lszform" parameterType="com.cardpay.pccredit.postLoan.filter.FcloaninfoFilter">

	    		select a.* from (	 select
       distinct 
       tkmx.ywbh,
       b.khmc,
       tkmx.jkrq,
       shbj.df as bj,
       shlx.df as lx,
       tkmx.jxfs,
       shbj.jzrq,
       sysuser.display_name,
       yehz.create_time
       from
        (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
      (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm,
                       max(lsz.jzrq) as jzrq
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
              ty_repay_tkmx tkmx,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
             ty_kdk_jh jh,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              b.khnm=tkmx.khh and
              jh.ywbh=tkmx.ywbh||'HT' and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              
               shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=b.zjhm and
             shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=b.Zjhm
               <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if>
			<!--  <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if> -->
                 order by tkmx.jkrq) a WHERE 1=1 
					
	<!-- 	<if test="rapayinterest != null and rapayinterest != '' ">
		   				AND a.rapayinterest=#{rapayinterest}
		   				</if>
		<if test="repayamt != null and repayamt != '' ">
		   				AND a.repayamt=#{repayamt}
		   				</if> -->
	</select>
	
	<select id="findLshJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from (
	  	 select
       distinct 
       tkmx.ywbh,
       b.khmc,
       tkmx.jkrq,
       shbj.df as bj,
       shlx.df as lx,
       tkmx.jxfs,
       shbj.jzrq,
       yehz.create_time
       from
        (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
      (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm,
                       max(lsz.jzrq) as jzrq
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
              ty_repay_tkmx tkmx,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
             ty_kdk_jh jh,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              b.khnm=tkmx.khh and
              jh.ywbh=tkmx.ywbh||'HT' and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              
               shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=b.zjhm and
             shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=b.Zjhm
               <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if>
			<!--  <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if> -->
                 order by tkmx.jkrq
	  	) a where 1=1
	</select>
	
	<select id="findObjectsByBusicode" resultMap="BaseResultMap1">
	    select *  from t_fcloaninfo a where 1=1 and 
	    a.BUSICODE=#{busicode}
	    
	</select>
	
	
	
	<select id="findTzJnListByFilter" resultMap="MibusidateView" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				select distinct YWBH,ID,KHH,KHMC,ZJHM,SSBM,SJ,SXED,GHJL,LOANDATE, DQRQ,DKQX,JZLL,REQLMT,nvl(DELAYINTERESTDAYS,0) as DELAYINTERESTDAYS ,  nvl(DELAYAMTDAYS,0) as DELAYAMTDAYS,
        DLAYDT,SHBJ,JKJE,KSQXRQ,PAYDEBT,DKYE as YE ,BNQX,BWQX,sum(DKYE+BNQX+BWQX) as dlayamtsum,BALAMT ,YXYE,USERID as  userid,DISPLAY_NAME as display_name
                 from ty_mibusidata where 1=1 
			           <if test="userId != null and userId != '' and userId !='000001'">
			             and USERID  =#{userId}
				         </if>
				         <if test="busiCode != null and busiCode != '' ">
							AND trim(YWBH)=#{busiCode}
						</if>
						<if test="customerName != null and customerName != '' ">
							AND KHMC=#{customerName}
						</if>
						  group by YWBH,ID,KHH,KHMC,ZJHM,SSBM,SJ,SXED,GHJL,LOANDATE, DQRQ,DKQX,JZLL,REQLMT,nvl(DELAYINTERESTDAYS,0),  nvl(DELAYAMTDAYS,0),
        DLAYDT,SHBJ,JKJE,KSQXRQ,PAYDEBT,DKYE ,BNQX,BWQX,BALAMT ,YXYE,USERID ,DISPLAY_NAME 
         order by LOANDATE
					<!--   select
			        distinct
			          tkmx.YWBH ,
			          b.id as id ,
			          b.KHH,
			          b.KHMC,
			          b.ZJHM,
			          rygl.SSBM,
			          b.SJ,
			          b.SXED,
			          b.GHJL,
			          tkmx.JKRQ as LOANDATE, 
			          tkmx.DQRQ,
			          tkmx.DKQX,
			          tkmx.JZLL,
			          tkmx.FFJE   as REQLMT,
			           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
			           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS, 
			           max(lsz.jzrq) as DLAYDT,
			          yehz.SHBJ,
			          yehz.JKJE,
			          yehz.KSQXRQ,
			          yehz.SHLX as PAYDEBT,  
			          yehz.DKYE as YE ,
			          yehz.BNQX,
			          yehz.BWQX,
			          yehz.DKYE as BALAMT  ,
			          yehz.dkye as yxye,
			          sysuser.id userid,
			          sysuser.display_name
			       from
			              ty_repay_tkmx tkmx,
			              ty_customer_base b,
			              ty_customer_rygl rygl,
			              sys_user sysuser,
			              ty_kdk_jh jh,
			              ty_repay_yehz yehz,
			              ty_repay_lsz lsz
			              where b.khjl=rygl.dm and
			              rygl.ddrq=sysuser.external_id and
			              b.khnm=tkmx.khh and
			              jh.ywbh=tkmx.ywbh||'HT' and
			              yehz.jjh=tkmx.jjh and
			              tkmx.jjh =lsz.jjh
			            <if test="userId != null and userId != '' and userId !='000001'">
			             and sysuser.id  =#{userId}
				         </if>
				         <if test="busiCode != null and busiCode != '' ">
							AND trim(tkmx.ywbh)=#{busiCode}
						</if>
						<if test="customerName != null and customerName != '' ">
							AND b.khmc=#{customerName}
						</if>
			              group by tkmx.YWBH ,b.id ,b.KHH,b.KHMC, b.ZJHM,rygl.SSBM, b.SJ, b.SXED, b.GHJL,tkmx.JKRQ , tkmx.DQRQ, tkmx.DKQX,tkmx.JZLL, tkmx.FFJE  ,
			                 yehz.SHBJ,yehz.JKJE, yehz.KSQXRQ,yehz.SHLX, yehz.DKYE,yehz.BNQX, yehz.BWQX,yehz.DKYE  , yehz.dkye  , sysuser.display_name, sysuser.id  
			              order by tkmx.jkrq-->
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	
	<select id="findTzJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from (
	  select distinct YWBH,ID,KHH,KHMC,ZJHM,SSBM,SJ,SXED,GHJL,LOANDATE, DQRQ,DKQX,JZLL,REQLMT,DELAYINTERESTDAYS,  DELAYAMTDAYS,
				DLAYDT,SHBJ,JKJE,KSQXRQ,PAYDEBT,DKYE as YE ,BNQX,BWQX,BALAMT ,YXYE,USERID as  userid,DISPLAY_NAME as display_name
			           from ty_mibusidata where 1=1 
			           <if test="userId != null and userId != '' and userId !='000001'">
			             and USERID  =#{userId}
			             order by LOANDATE
				         </if>
				         <if test="busiCode != null and busiCode != '' ">
							AND trim(YWBH)=#{busiCode}
						</if>
						<if test="customerName != null and customerName != '' ">
							AND KHMC=#{customerName}
						</if>
	  	) a
	 
	</select>
	
		<select id="findrefusedMibusidata" resultMap="refusemibusidata" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				  <!--  select tkmx.ywbh,basic.CHINESE_NAME,basic.CARD_ID,b.SJ as TELEPHONE,b.Cshy as industry,b.GTSPMC as spmc,b.YYDZ as RESIDENTIAL_ADDRESS,
                      yehz.JKJE,tkmx.JKRQ,pro.AUDIT_TIME,pro.REFUSAL_REASON,sysuser.DISPLAY_NAME, pro.PROCESS_OP_STATUS
                      from basic_customer_information basic,
                      ty_customer_base b,
                      ty_repay_tkmx tkmx,
                      ty_repay_yehz yehz,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where b.id=basic.ty_customer_id and
                            b.khnm=tkmx.khh and
                            tkmx.jjh=yehz.jjh and
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE' -->
					    select app.ID as ywbh,basic.CHINESE_NAME as CHINESE_NAME,basic.CARD_ID as CARD_ID,''as TELEPHONE,'' as industry,'' as spmc,'' as RESIDENTIAL_ADDRESS,
  				app.APPLY_QUOTA as JKJE,app.created_time as JKRQ,
                     pro.AUDIT_TIME as AUDIT_TIME,pro.REFUSAL_REASON as REFUSAL_REASON,sysuser.DISPLAY_NAME DISPLAY_NAME, pro.PROCESS_OP_STATUS
                      from basic_customer_information basic,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where 
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE'
					 <if test="busiCode != null and busiCode != '' ">
						AND trim(app.ID)=#{busiCode}
					 </if>
					 
					 <if test="customerName != null and customerName != '' ">
						AND basic.CHINESE_NAME =#{customerName}
					 </if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
		<select id="findrefusedMibusidatasize" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*) from (select app.ID as ywbh,basic.CHINESE_NAME as CHINESE_NAME,basic.CARD_ID as CARD_ID,''as TELEPHONE,'' as industry,'' as spmc,'' as RESIDENTIAL_ADDRESS,
  				app.APPLY_QUOTA as JKJE,app.created_time as JKRQ,
                     pro.AUDIT_TIME as AUDIT_TIME,pro.REFUSAL_REASON as REFUSAL_REASON,sysuser.DISPLAY_NAME DISPLAY_NAME, pro.PROCESS_OP_STATUS
                      from basic_customer_information basic,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where 
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE'
					 <if test="busiCode != null and busiCode != '' ">
						AND trim(app.ID)=#{busiCode}
					 </if>
					 
					 <if test="customerName != null and customerName != '' ">
						AND basic.CHINESE_NAME =#{customerName}
					 </if>)
	</select>
	
	<select id="findtzList"  resultMap="BaseResultMap3" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					  select
			        distinct
			          tkmx.YWBH Busicode,
			          b.id as id ,
			          b.KHH,
			          b.KHMC Cname,
			          b.ZJHM Custidno,
			          rygl.SSBM,
			          b.SJ,
			          b.SXED,
			          b.GHJL,
			          tkmx.JKRQ as Loandate, 
			          tkmx.DQRQ,
			          tkmx.DKQX,
			          tkmx.JZLL,
			          tkmx.FFJE   as Reqlmt,
			           tkmx.FFJE   as Money,
			           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end ) as DELAYINTERESTDAYS,  
			           (case when(to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) > 0 then (to_date(max(lsz.jzrq),'yyyy-mm-dd')-to_date(tkmx.dqrq,'yyyy-mm-dd')) else null  end )as DELAYAMTDAYS, 
			           max(lsz.jzrq) as DLAYDT,
			          yehz.SHBJ,
			          yehz.JKJE,
			          yehz.KSQXRQ,
			          yehz.SHLX as PAYDEBT,  
			          yehz.DKYE as Balamt ,
			          yehz.BNQX,
			          yehz.BWQX,
			          yehz.DKYE as BALAMT  ,
			          yehz.dkye as yxye,
			          sysuser.id userid,
			          sysuser.display_name
			       from
			              ty_repay_tkmx tkmx,
			              ty_customer_base b,
			              ty_customer_rygl rygl,
			              sys_user sysuser,
			              ty_kdk_jh jh,
			              ty_repay_yehz yehz,
			              ty_repay_lsz lsz
			              where b.khjl=rygl.dm and
			              rygl.ddrq=sysuser.external_id and
			              b.khnm=tkmx.khh and
			              jh.ywbh=tkmx.ywbh||'HT' and
			              yehz.jjh=tkmx.jjh and
			              tkmx.jjh =lsz.jjh
			            <if test="userId != null and userId != '' and userId !='000001'">
			             and sysuser.id  =#{userId}
				         </if>
				         <if test="busiCode != null and busiCode != '' ">
							AND trim(tkmx.ywbh)=#{busiCode}
						</if>
						<if test="customerName != null and customerName != '' ">
							AND b.khmc=#{customerName}
						</if>
			              group by tkmx.YWBH ,b.id ,b.KHH,b.KHMC, b.ZJHM,rygl.SSBM, b.SJ, b.SXED, b.GHJL,tkmx.JKRQ , tkmx.DQRQ, tkmx.DKQX,tkmx.JZLL, tkmx.FFJE  ,
			                 yehz.SHBJ,yehz.JKJE, yehz.KSQXRQ,yehz.SHLX, yehz.DKYE,yehz.BNQX, yehz.BWQX,yehz.DKYE  , yehz.dkye  , sysuser.display_name, sysuser.id 
			              order by tkmx.jkrq
		  <!--   <if test="busicode != null and busicode != ''">
		    and BUSICODE=#{busicode}
		    </if> -->
		</select>
		
		<!-- 信贷流程跟踪表 -->
	<select id="queryCreditProcess" resultMap="CreditProcess">
		  SELECT *from 
		  (SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select 
            bai.spmc,
            bai.chinese_name,
            (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
             (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             su.display_name,
            cai.created_time,
            cai.apply_quota,
            (case 
	        when cai.status ='audit'and tlog.examine_amount is null and sdh.sdtime is null then
	          '已申请'
	         when cai.status ='refuse' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
	          '被拒绝'
	         when cai.status ='returnedToFirst' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
	          '退回至客户经理'
	         when cai.status ='end' then
	          '放款成功'
	         when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
             and cai.status ='audit' and sdh.sdtime is null and cai.id not in (select capid from customer_sp) then
             '进件初审'
	         when cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) 
           	 and  cai.id in (select capid from customer_sp) then
             '审贷决议'
             when cai.id in (select capid from CUSTOMER_APPLICATION_SDH) then
             '审批结束' 
             else
	          ''  end) as status,
             cai.id
              from customer_application_info cai  
				  	  left join customer_application_process aa on cai.id=aa.application_id
			          left join basic_customer_information bai on cai.customer_id=bai.id
		              left join sys_user su on su.id=bai.user_id
		              left join ty_customer_base base on bai.ty_customer_id=base.id
		              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
		              left join  wf_process_record pr on pr.id = aa.serial_number
		              left join wf_status_queue_record t on t.current_process = pr.id 
		              left join wf_status_info s on t.current_status = s.id 
		              left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  	  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
		              where 1=1
					<if test="customername!=null and customername!='' ">
						    and bai.chinese_name like  '%'||#{customername}||'%'
					</if>
					 order by cai.created_time desc
                   <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	<!-- 统计行数 -->
	<select id="querySize" resultType="int" parameterType="com.cardpay.pccredit.postLoan.model.CreditProcess">
		  select count(*)
			  			from customer_application_info cai  
				  	  left join customer_application_process aa on cai.id=aa.application_id
			          left join basic_customer_information bai on cai.customer_id=bai.id
		              left join sys_user su on su.id=bai.user_id
		              left join ty_customer_base base on bai.ty_customer_id=base.id
		              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
		              left join  wf_process_record pr on pr.id = aa.serial_number
		              left join wf_status_queue_record t on t.current_process = pr.id 
		              left join wf_status_info s on t.current_status = s.id 
		              left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  	  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
		               where 1=1
			        <if test="customername!=null and customername!='' ">
						    and bai.chinese_name like  '%'||#{customername}||'%'
					</if>
	</select>
	
	<!-- 显示详情 -->
	<select id="queryAll" resultMap="CreditProcess" parameterType="String">
		     select  bai.spmc, bai.chinese_name,
             (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
             (select org.name from sys_organization org where id in(select t.org_id from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)))as bljg ,
             ''as dklx,
             (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             '' as hyfl,
             su.display_name,
             cai.created_time,
             cai.apply_quota,
             (case
             when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
             t.start_examine_time
             when cai.status ='approved' then
             sdh.sdtime
             when cai.status ='refuse' or cai.status ='returnedToFirst' then
             cai.modified_time
             end) as start_examine_time ,
           (case 
           when cai.status ='refuse' then
           '审核拒绝'
           when cai.status ='returnedToFirst' then
           '审核退回'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           '初审通过'
           when cai.status ='approved' then
           '决议通过'
           else '' end) as examine_result，
           (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_amount
           when cai.status ='approved' then
           sdh.sdje
           else  '' end) as examine_amount,cai.jkrq,
             (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_lv
           when cai.status ='approved' then
           sdh.lv else '' end) as examine_lv,
             (case 
           when cai.status ='audit' and tlog.examine_amount is null and sdh.sdtime is null then
            '已申请'
           when cai.status ='refuse' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '被拒绝'
           when cai.status ='returnedToFirst' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '退回至客户经理'
           when cai.status ='end' then
            '放款成功'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) and cai.status ='audit'
            and sdh.sdtime is null and cai.id not in (select capid from customer_sp) then
            '进件初审'
           when cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) 
           and  cai.id in (select capid from customer_sp) then
            '审贷决议'
           when cai.id in (select capid from CUSTOMER_APPLICATION_SDH) then
            '审批结束' 
            else
            ''  end) as status
             from customer_application_info cai  
                  left join customer_application_process aa on cai.id=aa.application_id
                  left join basic_customer_information bai on cai.customer_id=bai.id
                  left join sys_user su on su.id=bai.user_id
                  left join ty_customer_base base on bai.ty_customer_id=base.id
                  left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
                  left join  wf_process_record pr on pr.id = aa.serial_number
                  left join wf_status_queue_record t on t.current_process = pr.id 
                  left join wf_status_info s on t.current_status = s.id 
                  left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
                  where 1=1 and cai.id=#{id}
              
	</select>
	
	<!-- 导出-->
	<select id="creditProcessExportQueryAll" resultMap="CreditProcess" parameterType="com.cardpay.pccredit.postLoan.model.CreditProcess">
		       select  bai.spmc, bai.chinese_name,
             (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
             (select org.name from sys_organization org where id in(select t.org_id from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)))as bljg ,
             ''as dklx,
             (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             '' as hyfl,
             su.display_name,
             cai.created_time,
             cai.apply_quota,
             (case
             when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
             t.start_examine_time
             when cai.status ='approved' then
             sdh.sdtime
             when cai.status ='refuse' or cai.status ='returnedToFirst' then
             cai.modified_time
             end) as start_examine_time ,
           (case 
           when cai.status ='refuse' then
           '审核拒绝'
           when cai.status ='returnedToFirst' then
           '审核退回'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           '初审通过'
           when cai.status ='approved' then
           '决议通过'
           else '' end) as examine_result，
           (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_amount
           when cai.status ='approved' then
           sdh.sdje
           else  '' end) as examine_amount,cai.jkrq,
             (case 
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) 
            and sdh.sdtime is null then
           tlog.examine_lv
           when cai.status ='approved' then
           sdh.lv else '' end) as examine_lv,
             (case 
           when cai.status ='audit'and tlog.examine_amount is null and sdh.sdtime is null then
            '已申请'
           when cai.status ='refuse' and  cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '被拒绝'
           when cai.status ='returnedToFirst' and cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) then
            '退回至客户经理'
           when cai.status ='end' then
            '放款成功'
           when cai.id  in (select application_id from T_APP_MANAGER_AUDIT_LOG) and cai.status ='audit'
           and sdh.sdtime is null and cai.id not in (select capid from customer_sp)then
            '进件初审'
           when cai.id not in (select capid from CUSTOMER_APPLICATION_SDH) 
           and  cai.id in (select capid from customer_sp) then
            '审贷决议'
           when cai.id in (select capid from CUSTOMER_APPLICATION_SDH) then
            '审批结束' 
            else
            ''  end) as status, bai.CARD_ID
             from customer_application_info cai  
                  left join customer_application_process aa on cai.id=aa.application_id
                  left join basic_customer_information bai on cai.customer_id=bai.id
                  left join sys_user su on su.id=bai.user_id
                  left join ty_customer_base base on bai.ty_customer_id=base.id
                  left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
                  left join  wf_process_record pr on pr.id = aa.serial_number
                  left join wf_status_queue_record t on t.current_process = pr.id 
                  left join wf_status_info s on t.current_status = s.id 
                  left join T_APP_MANAGER_AUDIT_LOG tlog on tlog.application_id =cai.id
                  left join CUSTOMER_APPLICATION_SDH sdh on sdh.capid=cai.id
	</select>
	
	<!-- 根据身份证号查询是否转贷 -->
	<select id="queryByCardId" resultMap="CreditProcess" parameterType="String">
		     select zjhm from  ty_customer_base base where base.zjhm=#{cardId} or base.posfzh=#{cardId}
	</select>
</mapper>
