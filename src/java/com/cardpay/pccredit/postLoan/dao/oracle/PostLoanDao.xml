<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cardpay.pccredit.postLoan.dao.PostLoanDao">


	 <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.postLoan.model.Fcloaninfo" >
   			  <result column="KEYCODE" 		property="keycode" jdbcType="VARCHAR" /> 
			  <result column="YEAR" 		property="year" jdbcType="VARCHAR" /> 
			  <result column="TIMES"		property="times" jdbcType="VARCHAR" /> 
			  <result column="BUSICODE" 	property="busicode" jdbcType="VARCHAR" /> 
			  <result column="BUSITYPE" 	property="busitype" jdbcType="VARCHAR" /> 
			  <result column="DEPTCODE" 	property="deptcode" jdbcType="VARCHAR" /> 
			  <result column="INSTCITYCODE" property="instcitycode" jdbcType="VARCHAR" /> 
			  <result column="CONTRACTCODE" property="contractcode" jdbcType="VARCHAR" /> 
			  <result column="CUSTID" 		property="custid" jdbcType="VARCHAR" /> 
			  <result column="CNAME" 		property="cname" jdbcType="VARCHAR" /> 
			  <result column="TYPEID" 		property="typeid" jdbcType="VARCHAR" /> 
			  <result column="CUSTTYPE" 	property="custtype" jdbcType="VARCHAR" /> 
			  <result column="CUSTPROPERTY" property="custproperty" jdbcType="VARCHAR" /> 
			  <result column="ORGCERTCODE" 	property="orgcertcode" jdbcType="VARCHAR" /> 
			  <result column="UNITCUSTTYPE" property="unitcusttype" jdbcType="VARCHAR" /> 
			  <result column="CARDTYPE" 	property="cardtype" jdbcType="VARCHAR" /> 
			  <result column="CARDNUM" 		property="cardnum" jdbcType="VARCHAR" /> 
			  <result column="CITY" 		property="city" jdbcType="VARCHAR" /> 
			  <result column="DISTRICTCOUNTY" property="districtcounty" jdbcType="VARCHAR" /> 
			  <result column="TOWN"			  property="town" jdbcType="VARCHAR" /> 
			  <result column="COMMUNITY" 	  property="community" jdbcType="VARCHAR" /> 
			  <result column="INSTCODE" 	  property="instcode" jdbcType="VARCHAR" /> 
			  <result column="CURRENCY" 	  property="currency" jdbcType="VARCHAR" /> 
			  <result column="MONEY" 		  property="money" jdbcType="VARCHAR" /> 
			  <result column="BALAMT" 		  property="balamt" jdbcType="VARCHAR" /> 
			  <result column="DEBTINTEREST"   property="debtinterest" jdbcType="VARCHAR" /> 
			  <result column="REQLMT" 		  property="reqlmt" jdbcType="VARCHAR" /> 
			  <result column="LOANDATE" 	  property="loandate" jdbcType="VARCHAR" /> 
			  <result column="ENDDATE" 		  property="enddate" jdbcType="VARCHAR" /> 
			  <result column="BUSISTATE"      property="busistate" jdbcType="VARCHAR" /> 
			  <result column="CREDITLEVEL"    property="creditlevel" jdbcType="VARCHAR" /> 
			  <result column="INDUSTRY"       property="industry" jdbcType="VARCHAR" /> 
			  <result column="LOANPURPOSE"    property="loanpurpose" jdbcType="VARCHAR" /> 
			  <result column="MAINASSURE"     property="mainassure" jdbcType="VARCHAR" /> 
			  <result column="BUSIMANAGER"    property="busimanager" jdbcType="VARCHAR" /> 
			  <result column="ISBACK" 		  property="isback" jdbcType="VARCHAR" /> 
			  <result column="ISBIGCOMPANY"   property="isbigcompany" jdbcType="VARCHAR" /> 
			  <result column="STATE" 		  property="state" jdbcType="VARCHAR" /> 
			  <result column="ISLOWRISK" 	  property="islowrisk" jdbcType="VARCHAR" /> 
			  <result column="VALIDTIME" 	  property="validtime" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULT"     property="sortresult" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULTFIVE" property="sortresultfive" jdbcType="VARCHAR" /> 
			  <result column="PRESORTRESULT"  property="presortresult" jdbcType="VARCHAR" /> 
			  <result column="PRESORTFIVE"    property="presortfive" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTRESULT" property="autosortresult" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTREMARK" property="autosortremark" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTFIVE"   property="autosortfive" jdbcType="VARCHAR" /> 
			  <result column="ISADM" 		  property="isadm" jdbcType="VARCHAR" /> 
			  <result column="CUSTSCALE"      property="custscale" jdbcType="VARCHAR" /> 
			  <result column="OVERTIMES"      property="overtimes" jdbcType="VARCHAR" /> 
			  <result column="DELAYAMTDAYS"   property="delayamtdays" jdbcType="VARCHAR" /> 
			  <result column="DELAYINTERESTDAYS" property="delayinterestdays" jdbcType="VARCHAR" /> 
			  <result column="CHANGEFLAG" 		 property="changeflag" jdbcType="VARCHAR" /> 
			  <result column="CATEGORYTYPE" 	 property="categorytype" jdbcType="VARCHAR" /> 
			  <result column="OPERDATETIME"      property="operdatetime" jdbcType="VARCHAR" /> 
			  <result column="OPERATOR" 		 property="operator" jdbcType="VARCHAR" /> 
			  <result column="ISWORKMANU" 		 property="isworkmanu" jdbcType="VARCHAR" /> 
			  <result column="ADMDATE" 			 property="admdate" jdbcType="VARCHAR" /> 
			  <result column="AJUSTSTATE" 		 property="ajuststate" jdbcType="VARCHAR" /> 
			  <result column="ISTRANS" 			 property="istrans" jdbcType="VARCHAR" /> 
			  <result column="LASTYEARSORTRESULT" property="lastyearsortresult" jdbcType="VARCHAR" /> 
			  <result column="PROCESSID" 		  property="processid" jdbcType="VARCHAR" /> 
			  <result column="TOBADLOANREASON"    property="tobadloanreason" jdbcType="VARCHAR" /> 
			  <result column="BADLOANDATE" 		  property="badloandate" jdbcType="VARCHAR" /> 
			  <result column="CREATE_TIME" 		  property="create_time" jdbcType="VARCHAR" /> 
 	 </resultMap>
 	  <resultMap id="lszform" type="com.cardpay.pccredit.postLoan.model.TyRarepaylistForm" >
 	      	<result column="ywbh" 		property="ywbh" 			jdbcType="VARCHAR" />
 	      	<result column="jkrq" 		property="jkrq" 			jdbcType="VARCHAR" />
 	      	<result column="bj" 		property="bj" 			jdbcType="VARCHAR" />
 	      	<result column="lx" 		property="lx" 			jdbcType="VARCHAR" />
 	      	<result column="jxfs" 		property="jxfs" 			jdbcType="VARCHAR" />
 	      	<result column="jzrq" 		property="jzrq" 			jdbcType="VARCHAR" />
 	      	<result column="create_time" 		property="create_time" 			jdbcType="VARCHAR" />
 	 </resultMap>
 	 <resultMap id="BaseResultMap2" type="com.cardpay.pccredit.postLoan.model.RarepaylistForm" >
   		<result column="KEYCODE" 		property="keycode" 			jdbcType="VARCHAR" />
		<result column="REPAYDATE" 		property="repaydate" 		jdbcType="VARCHAR" />
		<result column="BUSICODE" 		property="busicode" 		jdbcType="VARCHAR" />
		<result column="REPAYAMT" 		property="repayamt" 		jdbcType="VARCHAR" />
		<result column="RAPAYINTEREST"	property="rapayinterest" 	jdbcType="VARCHAR" />
		<result column="SQUAREMODEL" 	property="squaremodel" 		jdbcType="VARCHAR" />
		<result column="SQUAREOPER" 	property="squareoper" 		jdbcType="VARCHAR" />
		<result column="HANDLESCHEMAID" property="handleschemaid" 	jdbcType="VARCHAR" />
		<result column="HANDLETYPEID" 	property="handletypeid"     jdbcType="VARCHAR" />
		<result column="INSTCODE" 		property="instcode" 		jdbcType="VARCHAR" />
		<result column="DEPTCODE" 		property="deptcode" 		jdbcType="VARCHAR" />
		<result column="INSTCITYCODE" 	property="instcitycode" 	jdbcType="VARCHAR" />
		<result column="OPERDATETIME" 	property="operdatetime" 	jdbcType="VARCHAR" />
		<result column="OPERATOR_1" 	property="operator_1" 		jdbcType="VARCHAR" />
		<result column="LOANSTATUS"	    property="loanstatus" 		jdbcType="VARCHAR" />
		<result column="ISTRANS" 		property="istrans" 			jdbcType="VARCHAR" />
		<result column="CREATE_TIME" 	property="create_time" 		jdbcType="VARCHAR" />
		<result column="PARAM1" 	    property="param1" 			jdbcType="VARCHAR" />
 	 </resultMap>
 	 <resultMap id="MibusidateView" type="com.cardpay.pccredit.postLoan.model.MibusidateView" >
	<result column="YWBH" property="YWBH" jdbcType="VARCHAR" />
	<result column="id" property="id" jdbcType="VARCHAR" />
	<result column="KHH" property="KHH" jdbcType="VARCHAR" />
	<result column="KHMC" property="KHMC" jdbcType="VARCHAR" />
	<result column="ZJHM" property="ZJHM" jdbcType="VARCHAR" />
	<result column="SSBM" property="SSBM" jdbcType="VARCHAR" />
	<result column="SJ" property="SJ" jdbcType="VARCHAR" />
	<result column="SXED" property="SXED" jdbcType="VARCHAR" />
	<result column="GHJL" property="GHJL" jdbcType="VARCHAR" />
	<result column="LOANDATE" property="LOANDATE" jdbcType="VARCHAR" />
	<result column="DQRQ" property="DQRQ" jdbcType="VARCHAR" />
	<result column="DKQX" property="DKQX" jdbcType="VARCHAR" />
	<result column="JZLL" property="JZLL" jdbcType="VARCHAR" />
	<result column="REQLMT" property="REQLMT" jdbcType="VARCHAR" />
	<result column="DELAYINTERESTDAYS" property="DELAYINTERESTDAYS" jdbcType="VARCHAR" />
	<result column="DELAYAMTDAYS" property="DELAYAMTDAYS" jdbcType="VARCHAR" />
	<result column="qs" property="qs" jdbcType="VARCHAR" />
	<result column="DLAYDT" property="DLAYDT" jdbcType="VARCHAR" />
	<result column="DF" property="DF" jdbcType="VARCHAR" />
	<result column="YE" property="YE" jdbcType="VARCHAR" />
	<result column="SHBJ" property="SHBJ" jdbcType="VARCHAR" />
	<result column="JKJE" property="JKJE" jdbcType="VARCHAR" />
	<result column="KSQXRQ" property="KSQXRQ" jdbcType="VARCHAR" />
	<result column="SHLX" property="SHLX" jdbcType="VARCHAR" />
	<result column="DKYE" property="DKYE" jdbcType="VARCHAR" />
	<result column="BNQX" property="BNQX" jdbcType="VARCHAR" />
	<result column="BWQX" property="BWQX" jdbcType="VARCHAR" />
	<result column="BALAMT" property="BALAMT" jdbcType="VARCHAR" />
	<result column="yxye" property="yxye" jdbcType="VARCHAR" /> 
	<result column="HKFS" property="HKFS" jdbcType="VARCHAR" />  
	<result column="je" property="je" jdbcType="VARCHAR" />  
	<result column="CREATE_TIME" property="CREATE_TIME" jdbcType="VARCHAR" />  
 	 </resultMap>
 	 
 	 <resultMap id="BaseResultMap3" type="com.cardpay.pccredit.postLoan.model.MibusidataForm" >
   		 <result column="BUSICODE"        property="busicode"    jdbcType="VARCHAR" />         
		 <result column="CUSTID"        property="custid"    jdbcType="VARCHAR" />         
		 <result column="CNAME"        property="cname"    jdbcType="VARCHAR" />         
		 <result column="DEPTCODE"        property="deptcode"    jdbcType="VARCHAR" />         
		 <result column="MAINASSURE"        property="mainassure"    jdbcType="VARCHAR" />         
		 <result column="REQLMT"        property="reqlmt"    jdbcType="VARCHAR" />         
		 <result column="LOANDATE"        property="loandate"    jdbcType="VARCHAR" />         
		 <result column="STARTDATE"        property="startdate"    jdbcType="VARCHAR" />         
		 <result column="ORIENDDATE"        property="orienddate"    jdbcType="VARCHAR" />         
		 <result column="ENDDATE"        property="enddate"    jdbcType="VARCHAR" />         
		 <result column="MONEY"        property="money"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="STATE"        property="accountstate"    jdbcType="VARCHAR" />         
		 <result column="CLOSEDATE"        property="closedate"    jdbcType="VARCHAR" />         
		 <result column="FIVECLASS"        property="fiveclass"    jdbcType="VARCHAR" />         
		 <result column="DELAYAMTDAYS"        property="delayamtdays"    jdbcType="VARCHAR" />         
		 <result column="DELAYINTERESTDAYS"        property="delayinterestdays"    jdbcType="VARCHAR" />         
		 <result column="FIRSTINTERESTDATE"        property="firstinterestdate"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTEREST"        property="debtinterest"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTERESTTIMES"        property="debtinteresttimes"    jdbcType="VARCHAR" />         
		 <result column="DLAYAMT"        property="dlayamt"    jdbcType="VARCHAR" />         
		 <result column="DLAYDT"        property="dlaydt"    jdbcType="VARCHAR" />         
		 <result column="PAYDEBT"        property="paydebt"    jdbcType="VARCHAR" />         
		 <result column="INDEBTAMT"        property="indebtamt"    jdbcType="VARCHAR" />         
		 <result column="OUTDEBTAMT"        property="outdebtamt"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="CREATE_TIME"        property="create_time"    jdbcType="VARCHAR" />    
		 <result column="CUSTIDNO"        property="custidno"    jdbcType="VARCHAR" />  
		 <result column="LIMIT"        property="limit"    jdbcType="VARCHAR" />  
		 <result column="REPAYMETHOD"        property="repaymethod"    jdbcType="VARCHAR" />  
		 <result column="SPMC"        property="SPMC"    jdbcType="VARCHAR" />  
		 <result column="JF"        property="jf"    jdbcType="VARCHAR" />  
		 <result column="AUDIT_TIME"        property="audittime"    jdbcType="DATE" />  
		 <result column="REFUSAL_REASON"        property="refusalreason"    jdbcType="VARCHAR" /> 
		 <result column="DISPLAY_NAME"        property="displayname"    jdbcType="VARCHAR" />  
 	 </resultMap>
 	  <resultMap id="refusemibusidata" type="com.cardpay.pccredit.postLoan.model.RefuseMibusidata" >
 	      <result column="ywbh"        property="ywbh"    jdbcType="VARCHAR" /> 
   		<result column="CHINESE_NAME"        property="CHINESE_NAME"    jdbcType="VARCHAR" />  
   		<result column="CARD_ID"        property="CARD_ID"    jdbcType="VARCHAR" /> 
   		<result column="TELEPHONE"        property="TELEPHONE"    jdbcType="VARCHAR" /> 
   		<result column="industry"        property="industry"    jdbcType="VARCHAR" />
   		<result column="spmc"        property="spmc"    jdbcType="VARCHAR" /> 
   		<result column="RESIDENTIAL_ADDRESS"        property="RESIDENTIAL_ADDRESS"    jdbcType="VARCHAR" /> 
   		<result column="JKJE"        property="JKJE"    jdbcType="VARCHAR" /> 
   		<result column="JKRQ"        property="JKRQ"    jdbcType="VARCHAR" /> 
   		<result column="AUDIT_TIME"        property="AUDIT_TIME"    jdbcType="VARCHAR" /> 
   		<result column="REFUSAL_REASON"        property="REFUSAL_REASON"    jdbcType="VARCHAR" /> 
   		<result column="DISPLAY_NAME"        property="DISPLAY_NAME"    jdbcType="VARCHAR" /> 
   		<result column="PROCESS_OP_STATUS"        property="PROCESS_OP_STATUS"    jdbcType="VARCHAR" /> 
 	 </resultMap>

	  <resultMap id="BaseResultMap" type="com.cardpay.pccredit.customer.model.TyRepayTkmxForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	  </resultMap>
 	 
 	 <!-- <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.customer.model.TyRepayLshForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	 </resultMap>
 	
 	
	 	<select id="findListByFilter" resultMap="BaseResultMap" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.product_name as productName,c.zjhm from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
		</select>
		
	<select id="findListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*) from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl
	</select> 
	
	
	<select id="findLshListByFilter" resultMap="BaseResultMap1" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.khjl as khjl1  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
					  order by a.jjh,b.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findLshListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
	</select>  -->
	
	<!-- BaseResultMap1 -->
	<select id="findJJJnListByFilter" resultMap="BaseResultMap" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				 select distinct tkmx.ywbh as ywbh,
			        base.khmc as cname,
			        base.zjhm as zjhm,
			        tkmx.jkrq,
			        tkmx.ffje as ffje,
			        yehz.DKYE as balamt,
			        yehz.bnqx+yehz.bwqx as debtinterest,
			        tkmx.ffje as reqlmt,
			        jh.ts as delayamtdays,  
			        jh.ts as delayinterestdays
			          from
           (select  tkmx.ywbh as ywbh,
                      max(to_number(jh.qs)) as qs
          from
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      ty_customer_rygl rygl,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      yehz.JJH = tkmx.JJH and
                      jh.ywbh=tkmx.ywbh||'HT' and
                      b.khjl=rygl.dm and
                      rygl.ddrq=sysuser.external_id
                   group by tkmx.ywbh)  maxqs,
                    ty_customer_rygl rygl,
                    ty_customer_base base,
                     ty_product_type protype,
                    ty_repay_tkmx tkmx,
                    SYS_USER sysuser  ,
                    ty_repay_yehz yehz,
                    ty_kdk_jh jh,
                    ty_repay_lsz lsz
                    WHERE 
                    base.khjl=rygl.dm
                    and rygl.ddrq=sysuser.external_id
                    and base.khnm=tkmx.khh
                    and tkmx.JJH=yehz.JJH
                    and protype.product_code=tkmx.cpmc
                    and jh.ywbh=tkmx.ywbh||'HT' 
                    and lsz.jjh=tkmx.jjh
                    and maxqs.ywbh=tkmx.ywbh
                    and maxqs.qs=jh.qs
                     <if test="userId != null and userId != '' ">
						AND sysuser.id=#{userId}
					   </if>
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(tkmx.ywbh)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(b.zjhm)=#{cardNum}
					  </if>
					  order  by tkmx.jkrq
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findJJJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(distinct tkmx.ywbh)    from
           (select  tkmx.ywbh as ywbh,
                      max(to_number(jh.qs)) as qs
          from
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      ty_customer_rygl rygl,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      yehz.JJH = tkmx.JJH and
                      jh.ywbh=tkmx.ywbh||'HT' and
                      b.khjl=rygl.dm and
                      rygl.ddrq=sysuser.external_id
                   group by tkmx.ywbh)  maxqs,
                    ty_customer_rygl rygl,
                    ty_customer_base base,
                     ty_product_type protype,
                    ty_repay_tkmx tkmx,
                    SYS_USER sysuser  ,
                    ty_repay_yehz yehz,
                    ty_kdk_jh jh,
                    ty_repay_lsz lsz
                    WHERE 
                    base.khjl=rygl.dm
                    and rygl.ddrq=sysuser.external_id
                    and base.khnm=tkmx.khh
                    and tkmx.JJH=yehz.JJH
                    and protype.product_code=tkmx.cpmc
                    and jh.ywbh=tkmx.ywbh||'HT' 
                    and lsz.jjh=tkmx.jjh
                    and maxqs.ywbh=tkmx.ywbh
                    and maxqs.qs=jh.qs
                    <if test="userId != null and userId != '' ">
						AND sysuser.id=#{userId}
					   </if>
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(a.BUSICODE)=#{busiCode}
		</if>
		<if test="cardNum != null and cardNum != '' ">
			AND trim(a.CARDNUM)=#{cardNum}
	   </if>
	    order  by tkmx.jkrq
	</select>
	
	
	
	<select id="findLshJnListByFilter" resultMap="lszform" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					 select
       distinct 
       tkmx.ywbh,
       tkmx.jkrq,
       shbj.df as bj,
       shlx.df as lx,
       tkmx.jxfs,
       shbj.jzrq,
       yehz.create_time
       from
        (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
      (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm,
                       max(lsz.jzrq) as jzrq
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
              ty_repay_tkmx tkmx,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
             ty_kdk_jh jh,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              b.khnm=tkmx.khh and
              jh.ywbh=tkmx.ywbh||'HT' and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              
               shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=b.zjhm and
             shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=b.Zjhm
               <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if>
			 <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if>
                 order by tkmx.jkrq
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="selectRarepaylistfoInfoByBusicode" resultMap="BaseResultMap2" parameterType="com.cardpay.pccredit.postLoan.filter.FcloaninfoFilter">

	    		select a.* from T_RAREPAYLIST a WHERE 1=1 
						AND a.BUSICODE=#{busiCode}
		<if test="rapayinterest != null and rapayinterest != '' ">
		   				AND a.rapayinterest=#{rapayinterest}
		   				</if>
		<if test="repayamt != null and repayamt != '' ">
		   				AND a.repayamt=#{repayamt}
		   				</if>
	</select>
	
	<select id="findLshJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from T_RAREPAYLIST a  WHERE 1=1 
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(a.BUSICODE)=#{busiCode}
		</if>
	</select>
	
	<select id="findObjectsByBusicode" resultMap="BaseResultMap1">
	    select *  from t_fcloaninfo a where 1=1 and 
	    a.BUSICODE=#{busicode}
	    
	</select>
	
	
	
	<select id="findTzJnListByFilter" resultMap="MibusidateView" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				<!-- trim(a.ACCOUNTSTATE) as STATE -->
					  select distinct a.* from (
					  select
		        distinct
		          tkmx.YWBH ,
		          b.id as id ,
		          b.KHH,
		          b.KHMC,
		          b.ZJHM,
		          rygl.SSBM,
		          b.SJ,
		          b.SXED,
		          b.GHJL,
		          tkmx.JKRQ as LOANDATE, 
		          tkmx.DQRQ,
		          tkmx.DKQX,
		          tkmx.JZLL,
		          tkmx.HKFS,
		          tkmx.FFJE   as REQLMT,  
		          tkmx.CREATE_TIME,
		          jh.ts as DELAYINTERESTDAYS, 
		           jh.ts as DELAYAMTDAYS,   
		           jh.qs as qs,    
		          rq.a+jh.ts as DLAYDT, 
		          jh.je,
		          yehz.SHBJ,
		          yehz.JKJE,
		          yehz.KSQXRQ,
		          yehz.SHLX,   
		          yehz.DKYE,
		          yehz.BNQX,
		          yehz.BWQX,
		          yehz.DKYE as BALAMT  ,
		          yehz.dkye as YE ,
		          sysuser.display_name
		        from
		           (select  basic.card_id  as cardid,
		                      max(to_number(jh.qs)) as qs
		          from
		         (select trunc(to_date(rq,'yyyy-mm-dd')) a from ty_kdk_jh) rq,
		                      TY_REPAY_TKMX tkmx,
		                      TY_CUSTOMER_BASE  b,
		                      ty_customer_rygl rygl,
		                      TY_REPAY_YEHZ yehz,
		                      ty_kdk_jh jh,
		                      basic_customer_information basic,
		                      sys_user sysuser
		                      where 1=1 and
		                      b.khnm=tkmx.khh and
		                      b.khjl=rygl.dm and
		                      yehz.JJH = tkmx.JJH and
		                      substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
		                      b.id=basic.ty_customer_id and
		                      basic.user_id=sysuser.id and
		                      rq.a=to_date(jh.rq,'yyyy-mm-dd')
		                  	<if test="userId != null and userId != '' ">
					             and sysuser.id  =#{userId}
					         </if>
					          <if test="busiCode != null and busiCode != '' ">
								AND trim(tkmx.YWBH)=#{busiCode}
							 </if>
							 <if test="customerName != null and customerName != '' ">
								AND b.KHMC =#{customerName}
							 </if>
		                   group by basic.card_id)  maxqs,
		         (select trunc(to_date(rq,'yyyy-mm-dd')) a from ty_kdk_jh) rq,
		                      TY_REPAY_TKMX tkmx,
		                      TY_CUSTOMER_BASE  b,
		                      ty_customer_rygl rygl,
		                      TY_REPAY_YEHZ yehz,
		                      ty_kdk_jh jh,
		                      basic_customer_information basic,
		                      sys_user sysuser
		                      where 1=1 and
		                      b.khnm=tkmx.khh and
		                      b.khjl=rygl.dm and
		                      yehz.JJH = tkmx.JJH and
		                              substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
		                              b.id=basic.ty_customer_id and
		                              basic.user_id=sysuser.id and
		                               rq.a=to_date(jh.rq,'yyyy-mm-dd') 
		                               and jh.qs=maxqs.qs
		                               and basic.card_id=maxqs.cardid
					  ) a where 1=1
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	
	<select id="findTzJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from (
	  	select
        distinct
          tkmx.YWBH ,
          b.id as id ,
          b.KHH,
          b.KHMC,
          b.ZJHM,
          rygl.SSBM,
          b.SJ,
          b.SXED,
          b.GHJL,
          tkmx.JKRQ as LOANDATE, 
          tkmx.DQRQ,
          tkmx.DKQX,
          tkmx.JZLL,
          tkmx.FFJE   as REQLMT,  
         jh.ts as DELAYINTERESTDAYS, 
           jh.ts as DELAYAMTDAYS,   
           jh.qs as qs,    
            rq.a+jh.ts as DLAYDT, 
          yehz.SHBJ,
          yehz.JKJE,
          yehz.KSQXRQ,
          yehz.SHLX,   
          yehz.DKYE,
          yehz.BNQX,
          yehz.BWQX,
          yehz.DKYE as BALAMT  ,
          yehz.dkye as yxye ,
          sysuser.display_name
        from
           (select  basic.card_id  as cardid,
                      max(to_number(jh.qs)) as qs
          from
         (select trunc(to_date(rq,'yyyy-mm-dd')) a from ty_kdk_jh) rq,
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      ty_customer_rygl rygl,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      basic_customer_information basic,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      b.khjl=rygl.dm and
                      yehz.JJH = tkmx.JJH and
                              substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
                              b.id=basic.ty_customer_id and
                              basic.user_id=sysuser.id and
                               rq.a=to_date(jh.rq,'yyyy-mm-dd')
                  <if test="userId != null and userId != '' ">
			             and sysuser.id  =#{userId}
			         </if>
                   group by basic.card_id)  maxqs,
         (select trunc(to_date(rq,'yyyy-mm-dd')) a from ty_kdk_jh) rq,
                      TY_REPAY_TKMX tkmx,
                      TY_CUSTOMER_BASE  b,
                      ty_customer_rygl rygl,
                      TY_REPAY_YEHZ yehz,
                      ty_kdk_jh jh,
                      basic_customer_information basic,
                      sys_user sysuser
                      where 1=1 and
                      b.khnm=tkmx.khh and
                      b.khjl=rygl.dm and
                      yehz.JJH = tkmx.JJH and
                              substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
                              b.id=basic.ty_customer_id and
                              basic.user_id=sysuser.id and
                               rq.a=to_date(jh.rq,'yyyy-mm-dd') 
                               and jh.qs=maxqs.qs
                               and basic.card_id=maxqs.cardid
	  	) a
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(YWBH)=#{busiCode}
		</if>
		
	  	<if test="customerName != null and customerName != '' ">
			AND KHMC =#{customerName}
		 </if>
	</select>
	
		<select id="findrefusedMibusidata" resultMap="refusemibusidata" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
				   select tkmx.ywbh,basic.CHINESE_NAME,basic.CARD_ID,b.SJ as TELEPHONE,b.Cshy as industry,b.GTSPMC as spmc,b.YYDZ as RESIDENTIAL_ADDRESS,
                      yehz.JKJE,tkmx.JKRQ,pro.AUDIT_TIME,pro.REFUSAL_REASON,sysuser.DISPLAY_NAME, pro.PROCESS_OP_STATUS
                      from basic_customer_information basic,
                      ty_customer_base b,
                      ty_repay_tkmx tkmx,
                      ty_repay_yehz yehz,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where b.id=basic.ty_customer_id and
                            b.khnm=tkmx.khh and
                            tkmx.jjh=yehz.jjh and
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE'
					    <!--   select info.SPMC,lsz.JF,pro.AUDIT_TIME,pro.REFUSAL_REASON,sysuser.DISPLAY_NAME
		           from   mibusidata a,
		                  ty_customer_base b,
		                  customer_application_info app,
		                  basic_customer_information info,
		                  ty_repay_tkmx tkmx,
		                  TY_REPAY_LSZ lsz,
		                  product_attribute prod,
		                  customer_application_process pro,
		                  sys_user sysuser
		                  where 1=1
		                  and b.id=info.TY_CUSTOMER_ID
		                  and b.khnm = tkmx.KHH
		                  and a.YWBH=tkmx.ywbh
		                  and tkmx.JJH=lsz.JJH
		                  and app.customer_id = info.id
		                  and app.product_id = prod.id
		                  and app.id = pro.application_id
		            and sysuser.id = info.user_id 
		                  and app.status ='refuse' -->
					 <if test="busiCode != null and busiCode != '' ">
						AND trim(tkmx.ywbh)=#{busiCode}
					 </if>
					 
					 <if test="customerName != null and customerName != '' ">
						AND basic.CHINESE_NAME =#{customerName}
					 </if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
		<select id="findrefusedMibusidatasize" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from basic_customer_information basic,
                      ty_customer_base b,
                      ty_repay_tkmx tkmx,
                      ty_repay_yehz yehz,
                      customer_application_info app,
                      customer_application_process pro,
                      sys_user sysuser
                      where b.id=basic.ty_customer_id and
                            b.khnm=tkmx.khh and
                            tkmx.jjh=yehz.jjh and
                            app.customer_id=basic.id and 
                            app.id=pro.application_id and
                            sysuser.id=basic.user_id
                             and pro.PROCESS_OP_STATUS ='REJECTAPPROVE'
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(tkmx.ywbh)=#{busiCode}
		</if>
		
	  	<if test="customerName != null and customerName != '' ">
			AND basic.CHINESE_NAME =#{customerName}
		 </if>
	</select>
	
	<select id="findtzList"  resultMap="BaseResultMap3" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
		    select * from (select
		        distinct
		          tkmx.YWBH ,
		          b.id as id ,
		          b.KHH,
		          b.KHMC,
		          b.ZJHM,
		          rygl.SSBM,
		          b.SJ,
		          b.SXED,
		          b.GHJL,
		          tkmx.JKRQ as LOANDATE, 
		          tkmx.DQRQ,
		          tkmx.DKQX,
		          tkmx.JZLL,
		          tkmx.FFJE   as REQLMT,  
		         jh.ts as DELAYINTERESTDAYS, 
		           jh.ts as DELAYAMTDAYS,   
		           jh.qs as qs,    
		            rq.a+jh.ts as DLAYDT, 
		          yehz.SHBJ,
		          yehz.JKJE,
		          yehz.KSQXRQ,
		          yehz.SHLX,   
		          yehz.DKYE,
		          yehz.BNQX,
		          yehz.BWQX,
		          yehz.DKYE as BALAMT  ,
		          yehz.dkye as YE ,
		          sysuser.display_name
		        from
		           (select  basic.card_id  as cardid,
		                      max(to_number(jh.qs)) as qs
		          from
		         (select trunc(to_date(rq,'yyyy-mm-dd')) a from ty_kdk_jh) rq,
		                      TY_REPAY_TKMX tkmx,
		                      TY_CUSTOMER_BASE  b,
		                      ty_customer_rygl rygl,
		                      TY_REPAY_YEHZ yehz,
		                      ty_kdk_jh jh,
		                      basic_customer_information basic,
		                      sys_user sysuser
		                      where 1=1 and
		                      b.khnm=tkmx.khh and
		                      b.khjl=rygl.dm and
		                      yehz.JJH = tkmx.JJH and
		                              substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
		                              b.id=basic.ty_customer_id and
		                              basic.user_id=sysuser.id and
		                               rq.a=to_date(jh.rq,'yyyy-mm-dd')
		                  <if test="userId != null and userId != '' ">
					             and sysuser.id  =#{userId}
					         </if>
		                   group by basic.card_id)  maxqs,
		         (select trunc(to_date(rq,'yyyy-mm-dd')) a from ty_kdk_jh) rq,
		                      TY_REPAY_TKMX tkmx,
		                      TY_CUSTOMER_BASE  b,
		                      ty_customer_rygl rygl,
		                      TY_REPAY_YEHZ yehz,
		                      ty_kdk_jh jh,
		                      basic_customer_information basic,
		                      sys_user sysuser
		                      where 1=1 and
		                      b.khnm=tkmx.khh and
		                      b.khjl=rygl.dm and
		                      yehz.JJH = tkmx.JJH and
		                              substr(jh.ywbh,1,length(jh.ywbh)-2)=tkmx.ywbh and
		                              b.id=basic.ty_customer_id and
		                              basic.user_id=sysuser.id and
		                               rq.a=to_date(jh.rq,'yyyy-mm-dd') 
		                               and jh.qs=maxqs.qs
		                               and basic.card_id=maxqs.cardid) a
		  <!--   <if test="busicode != null and busicode != ''">
		    and BUSICODE=#{busicode}
		    </if> -->
		</select>
</mapper>
